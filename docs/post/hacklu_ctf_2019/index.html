<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>hack.lu CTF 2019 Writeup - CTF Writeups</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="きゃぷあめ" /><meta name="description" content="URL: https://fluxfingersforfuture.fluxfingers.net/challenges/ 以下は、チャレンジ一覧です。 平日だったこともあり、17番のmisc問題だけトライしました。 実は、解けてないですが、なんとなく方向性はあっ" /><meta name="keywords" content="CTF, Writeup, captureamerica, picoCTF" />



<meta name="google-site-verification" content="PqctLWZQttGzxXVupWuIt2HWuBI8cvN1z07ETpxA2dw" />


<meta name="generator" content="Hugo 0.59.1 with theme even" />


<link rel="canonical" href="https://captureamerica.github.io/writeups/post/hacklu_ctf_2019/" />
<link rel="apple-touch-icon" sizes="180x180" href="https://captureamerica.github.io/writeups/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://captureamerica.github.io/writeups/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://captureamerica.github.io/writeups/favicon-16x16.png">
<link rel="manifest" href="https://captureamerica.github.io/writeups/manifest.json">
<link rel="mask-icon" href="https://captureamerica.github.io/writeups/safari-pinned-tab.svg" color="#5bbad5">


<link href="https://captureamerica.github.io/writeups/dist/even.c2a46f00.min.css" rel="stylesheet">



<meta property="og:title" content="hack.lu CTF 2019 Writeup" />
<meta property="og:description" content="URL: https://fluxfingersforfuture.fluxfingers.net/challenges/ 以下は、チャレンジ一覧です。 平日だったこともあり、17番のmisc問題だけトライしました。 実は、解けてないですが、なんとなく方向性はあっ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://captureamerica.github.io/writeups/post/hacklu_ctf_2019/" />
<meta property="article:published_time" content="2019-10-26T05:00:00+09:00" />
<meta property="article:modified_time" content="2019-10-26T05:00:00+09:00" />
<meta itemprop="name" content="hack.lu CTF 2019 Writeup">
<meta itemprop="description" content="URL: https://fluxfingersforfuture.fluxfingers.net/challenges/ 以下は、チャレンジ一覧です。 平日だったこともあり、17番のmisc問題だけトライしました。 実は、解けてないですが、なんとなく方向性はあっ">


<meta itemprop="datePublished" content="2019-10-26T05:00:00&#43;09:00" />
<meta itemprop="dateModified" content="2019-10-26T05:00:00&#43;09:00" />
<meta itemprop="wordCount" content="1111">



<meta itemprop="keywords" content="CTF," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="hack.lu CTF 2019 Writeup"/>
<meta name="twitter:description" content="URL: https://fluxfingersforfuture.fluxfingers.net/challenges/ 以下は、チャレンジ一覧です。 平日だったこともあり、17番のmisc問題だけトライしました。 実は、解けてないですが、なんとなく方向性はあっ"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://captureamerica.github.io/writeups/" class="logo">CTF Writeups</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="https://captureamerica.github.io/writeups/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="https://captureamerica.github.io/writeups/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="https://captureamerica.github.io/writeups/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="https://captureamerica.github.io/writeups/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="https://captureamerica.github.io/writeups/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="https://captureamerica.github.io/writeups/" class="logo">CTF Writeups</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">hack.lu CTF 2019 Writeup</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-10-26 </span>
        <div class="post-category">
            <a href="https://captureamerica.github.io/writeups/categories/ctf/"> CTF </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#misc-futuristic-communication">[Misc]: Futuristic Communication</a>
<ul>
<li><a href="#challenge">Challenge</a></li>
<li><a href="#unsolved">Unsolved</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>
    <div class="post-content">
      

<p>URL: <a href="https://fluxfingersforfuture.fluxfingers.net/challenges/">https://fluxfingersforfuture.fluxfingers.net/challenges/</a>
<br /><br />
以下は、チャレンジ一覧です。</p>

<p><img src="https://captureamerica.github.io/writeups/img/hack.lu_ctf_2019_chall_list.png" alt="hack.lu_ctf_2019_chall_list.png">
<br /><br />
平日だったこともあり、17番のmisc問題だけトライしました。</p>

<p>実は、解けてないですが、なんとなく方向性はあってる気がするのでWriteup残しておきます。</p>

<p><br /><br /></p>

<h2 id="misc-futuristic-communication">[Misc]: Futuristic Communication</h2>

<hr />

<h3 id="challenge">Challenge</h3>

<blockquote>
<p>Communication in the future is a big thing. With the rising amount of data in the internet new handshake techniques are required. Here is my implementation, where I can identify who did request which resources.
<br /><br />
<b>Remark:</b> The remote host in the PCAPs is not the host you have to connect to.
<br /><br />
<b>Note:</b> Because we use network protocols in a very futuristic way, you should check your network setup like firewall or router if you have problems solving this challenge. Maybe it&rsquo;s easier for you to use a cloud provider.
<br /><br />
Announcements for Futuristic Communication<br />
(Published on 2019-10-23 02:08:22)<br />
Because we use network protocols in a very futuristic way, you should check your network setup like firewall or router if you have problems solving this challenge. Maybe it&rsquo;s easier for you to use a cloud provider.
<br /><br />
(Published on 2019-10-22 16:56:08)<br />
Due to high load the server may sometimes have difficulty keeping up with processing identifiers which may cause the package to be dropped. Please insert a delay of about 1-2 seconds before sending a package containing an identifier to ensure those packages will be processed.</p>
</blockquote>

<p>Attachments:</p>

<ul>
<li>futuristic_communication.pcapng</li>
</ul>

<p><br /></p>

<h3 id="unsolved">Unsolved</h3>

<p>まずは、Wiresharkでpcapを開いて、Follow TCP Streamします。</p>

<pre>
Welcome to handshake in future!
Your personal identifier is: 051733e3-ec47-4518-9ff9-9ec90af9b27b
Waiting for identification, on TCP port 13792
Identification successful. Waiting for further instructions.
Expecting handshake, on TCP port 38462, with sequence number 2339380618
Connection setup noticed. Your Commands:
synchronize
privileged
flag

All your TCP flags should be SYN flags.
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
synchronize... success
Check if the connection is synchronized.
Connection synchronized. Entering privileged mode.
flag{only-to-show-now-comes-flag}
</pre>

<p>&ldquo;tcp.port==13792&rdquo; でフィルターすると、受け取った personal identifier を SYNパケットにくっつけて送っているのが見えます。</p>

<p><img src="https://captureamerica.github.io/writeups/img/hack.lu_ctf_2019_tcp_13792.png" alt="hack.lu_ctf_2019_tcp_13792.png"></p>

<p><br />
&ldquo;tcp.port==38462&rdquo; でフィルターすると、受け取った sequence number をSYNパケットにくっつけて送っているのが見えます。あと、personal identifier も付いてます。</p>

<p><img src="https://captureamerica.github.io/writeups/img/hack.lu_ctf_2019_tcp_38462.png" alt="hack.lu_ctf_2019_tcp_38462.png"></p>

<p>これを見る限り、SYNを送った後にまずRSTが返り、その後SYN/ACKが返ってくるように見えます。</p>

<p><br /><br />
とりあえず、ここまでの処理をScapyを使って書きました。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;31.22.123.60&#39;</span><span class="p">,</span> <span class="mi">1337</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="nb">id</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;Your personal identifier is: (.*)\n&#34;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># print id</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;Waiting for identification, on TCP port (.*)\n&#34;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># print port</span>

<span class="n">srcport</span> <span class="o">=</span> <span class="mi">37614</span>
<span class="n">pkt</span><span class="o">=</span><span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s2">&#34;31.22.123.60&#34;</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">dport</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">sport</span><span class="o">=</span><span class="n">srcport</span><span class="p">)</span><span class="o">/</span><span class="nb">id</span>
<span class="n">send</span><span class="p">(</span><span class="n">pkt</span><span class="p">)</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;with sequence number&#34;</span><span class="p">)</span>
<span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s2">&#34;Expecting handshake, on TCP port (.*), &#34;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="n">port</span>

<span class="n">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
<span class="n">seqnum</span>  <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="k">print</span> <span class="n">seqnum</span>
<span class="n">pkt</span><span class="o">=</span><span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s2">&#34;31.22.123.60&#34;</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">dport</span><span class="o">=</span><span class="n">port</span><span class="p">,</span><span class="n">sport</span><span class="o">=</span><span class="n">srcport</span><span class="p">,</span><span class="n">seq</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">seqnum</span><span class="p">))</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ans</span><span class="o">=</span><span class="n">sr</span><span class="p">(</span><span class="n">pkt</span><span class="p">)</span>
<span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">## This fails with &#34;Invalid packet. Exiting&#34; error...</span></code></pre></td></tr></table>
</div>
</div>
<p><br />
残念ながら、sequence numberを指定した SYNパケットがInvalidのようです。</p>

<p>以下、Follow TCP Streamです。
<pre>
Welcome to handshake in future!
Your personal identifier is: ae08b500-d644-47fa-9c7e-23acbd82d00f
Waiting for identification, on TCP port 20428
Identification successful. Waiting for further instructions.
Expecting handshake, on TCP port 54538, with sequence number 728714096
Invalid packet. Exiting     &lt;==これ
</pre></p>

<p><br />
&ldquo;tcp.port==54538&rdquo; でフィルターしたものです。sequence number もちゃんと設定できているし、合っていると思うんですけどね。どこら辺がInvalidなのかわかんないです。</p>

<p><img src="https://captureamerica.github.io/writeups/img/hack.lu_ctf_2019_tcp_54538.png" alt="hack.lu_ctf_2019_tcp_54538.png"></p>

<p><br />
Handshakeがうまく行けば、あとは、synchronize、privileged、flagコマンドを送るだけなんだと思います。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-Python" data-lang="Python"><span class="n">pkt</span><span class="o">=</span><span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s2">&#34;31.22.123.60&#34;</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">dport</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">sport</span><span class="o">=</span><span class="n">srcport</span><span class="p">)</span><span class="o">/</span><span class="s2">&#34;synchronize&#34;</span>
<span class="n">pkt</span><span class="o">=</span><span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s2">&#34;31.22.123.60&#34;</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">dport</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">sport</span><span class="o">=</span><span class="n">srcport</span><span class="p">)</span><span class="o">/</span><span class="s2">&#34;privileged&#34;</span>
<span class="n">pkt</span><span class="o">=</span><span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s2">&#34;31.22.123.60&#34;</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">dport</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">sport</span><span class="o">=</span><span class="n">srcport</span><span class="p">)</span><span class="o">/</span><span class="s2">&#34;flag&#34;</span></code></pre></td></tr></table>
</div>
</div>
<p><br />
なお、SYN/ACKを受信するにあたって、iptablesの設定も要ります。今回は、SYNがInvalid packet扱いされているので、そこまで行ってないですけど。</p>

<p>Mac OSだと、pfctlでやるみたいです。</p>

<p><br /><br />
<br /><br /></p>

<hr />

<p><br /><br />
<br /><br /></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">きゃぷあめ</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2019-10-26
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="https://captureamerica.github.io/writeups/tags/ctf/">CTF</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="https://captureamerica.github.io/writeups/post/ritsec_ctf_2019/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">RITSEC CTF 2019 Writeup</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="https://captureamerica.github.io/writeups/post/cryptix_ctf_2019/">
            <span class="next-text nav-default">Cryptix CTF 2019 Writeup</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/CaptureAmerica/" class="iconfont icon-github" title="github"></a>
  <a href="https://captureamerica.github.io/writeups/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">きゃぷあめ</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  
<script type="text/javascript" src="https://captureamerica.github.io/writeups/dist/even.26188efa.min.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-104910699-2', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
